Q1. Q. write a SQL query to calculate total purchase amount of all orders. Return total purchase amount.

Answer:
select sum(purch_am) from orderr;



Q2. Q. write a SQL query to calculate the average purchase amount of all orders. Return average purchase amount.

Answer:
select avg(purch_am) from orderr;



Q3. Q.write a SQL query that counts the number of unique salespeople. Return number of salespeople.

Answer:
select count(distinct salesman_id)from orderr;



Q4. Q.write a SQL query to count the number of customers. Return number of customers.

Answer:
select count(cust_name) from customer;



Q5. Q. write a SQL query to determine the number of customers who received at least one grade for their activity.

Answer:
select count(cust_name) from customer
where grade >= 1;



Q6. Q.write a SQL query to find the maximum purchase amount.

Answer:
select max(purch_am) from orderr;



Q7. Q.write a SQL query to find the minimum purchase amount.

Answer:
select min(purch_am) from orderr;



Q8. Q.write a SQL query to find the highest grade of the customers in each city. Return city, maximum grade.

Answer:
select max(grade),city from customer
group by city
order by max(grade) desc;



Q9. Q.write a SQL query to find the highest purchase amount ordered by each customer. Return customer ID, maximum purchase amount.

Answer:
select customr_id, max(purch_am) from orderr
group by customr_id
order by customr_id asc;



Q10. Q.write a SQL query to find the highest purchase amount ordered by each customer on a particular date. Return, order date and highest purchase amount.

Answer:
select customr_id, ord_date, max(purch_am) from orderr
group by customr_id, ord_date                 ----not done
order by max(purch_am) desc;



Q11. Q.write a SQL query to determine the highest purchase amount made by each salesperson on '2012

Answer:
select max(purch_am),selsman_id from orderr
where ord_date = TO_DATE('08-17-2012', 'MM-DD-YYYY')
group by selsman_id ;



Q12. Q. write a SQL query to find the highest order (purchase) amount by each customer on a particular order date. Filter the result by highest order (purchase) amount above 2000.00. Return customer id, order date and maximum purchase amount.

Answer:
select customr_id, ord_date, max(purch_am) from orderr
group by customr_id, ord_date
having max(purch_am)> 2000;



Q13. Q.write a SQL query to find the maximum order (purchase) amount in the range 2000

Answer:
select customr_id, ord_date, max(purch_am) from orderr
group by customr_id, ord_date
having max(purch_am) between 2000 and 6000;



Q14. Q.write a SQL query to find the maximum order (purchase) amount based on the combination of each customer and order date. Filter the rows for maximum order (purchase) amount is either 2000, 3000, 5760, 6000.

Answer:
select customr_id, ord_date, max(purch_am) from orderr
group by customr_id, ord_date
having max(purch_am) in (2000, 3000, 5760, 6000) ;



Q15. Q. write a SQL query to determine the maximum order amount for each customer. The customer ID should be in the range 3002 and 3007(Begin and end values are included.).

Answer:
select customr_id, max(purch_am) from orderr
group by customr_id
having customr_id between 3002 and 3007;



Q16. Q.write a SQL query to find the maximum order (purchase) amount for each customer. The customer ID should be in the range 3002 and 3007(Begin and end values are included.).

Answer:
select customr_id, max(purch_am) from orderr
where customr_id between 3002 and 3007
group by customr_id
having max(purch_am) > 1000;



Q17. Q.write a SQL query to determine the maximum order (purchase) amount generated by each salesperson.

Answer:
select selsman_id, max(purch_am) from orderr
where selsman_id between 5003 and 5008
group by selsman_id;



Q18. Q, write a SQL query to count all the orders generated on '2012

Answer:
select count(ord_no) from orderr
group by ord_date
having ord_date = to_date('08-17-2012', 'MM-DD-YYYY');



Q19. Q.write a SQL query to count the number of salespeople in a city. Return number of salespeople.

Answer:
select count(all city) from salesman;



Q20. Q.write a SQL query to count the number of orders based on the combination of each order date and salesperson.

Answer:
select ord_date, salesman_id, count(ord_no) from orderr
group by ord_date, salesman_id;


-- Assigns a unique sequential integer to rows within a partition, ordered by the specified columns.
SELECT employee_id, department_id, salary,
       ROW_NUMBER() OVER (PARTITION BY department_id ORDER BY salary DESC) AS row_num
FROM hr.employees;

SELECT employee_id, salary,
       ROW_NUMBER() OVER (ORDER BY salary DESC) AS row_num
FROM hr.employees;


-- Provides a rank to each row within a partition, with gaps in ranks for tied values.
SELECT employee_id, department_id, salary,
      RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) AS rank
FROM hr.employees;


-- Similar to RANK(), but without gaps. Tied values share the same rank, and the next rank is incremented sequentially.
SELECT employee_id, salary,
       DENSE_RANK() OVER (ORDER BY salary DESC) AS dense_rank
FROM hr.employees;


-- Accesses data from the following row, allowing for "look
SELECT employee_id, salary,
       LEAD(salary, 1) OVER (ORDER BY salary) AS next_salary
FROM hr.employees;


-- Accesses data from the preceding row, allowing for "look
SELECT employee_id, salary,
       LAG(salary, 2, 0) OVER (ORDER BY salary) AS previous_salary
FROM hr.employees;



Q21. From the following tables, write a SQL query to find all salespeople and customers located in the city of London.

Answer:
select salesman_id,name as salesman_name ,city  from salesman
where city = 'London'
union
select customer_id,cust_name as customer_name, city from customer
where city = 'London' ;



Q22. From the following tables, write a SQL query to find distinct salespeople and their cities. Return salesperson ID and city.

Answer:
select salesman_id ,city  from salesman
union
select salesman_id, city from customer ;



Q23. From the following tables, write a SQL query to find all those salespeople and customers who are involved

Answer:
select customr_id ,salesman_id from orderr
union
select customer_id ,salesman_id from customer ;



Q24. From the following table, write a SQL query to find the salespersons who generated the largest

Answer:
select s.salesman_id ,name , ord_no, ord_date, 'highest on'
from salesman s, orderr o
where s.salesman_id = o.salesman_id
and purch_am = (select max(purch_am) from orderr b where o.ord_date = b.ord_date )
union
select s.salesman_id ,name , ord_no, ord_date, 'lowest on'
from salesman s, orderr o
where s.salesman_id = o.salesman_id
and purch_am = (select min(purch_am) from orderr b where o.ord_date = b.ord_date ) ;



Q25. From the following tables, write a SQL query to find the salespeople who generated the largest

Answer:
select s.salesman_id ,name , ord_no, ord_date, 'highest on'
from salesman s, orderr o
where s.salesman_id = o.salesman_id
and purch_am = (select max(purch_am) from orderr b where o.ord_date = b.ord_date )
union
select s.salesman_id ,name , ord_no, ord_date, 'lowest on'
from salesman s, orderr o
where s.salesman_id = o.salesman_id
and purch_am = (select min(purch_am) from orderr b where o.ord_date = b.ord_date )
order by 3 ;



Q26. From the following tables, write a SQL query to find those salespeople who live in the same city

Answer:
SELECT salesman.salesman_id, name as salespeople_name, cust_name, commission
FROM salesman, customer
WHERE salesman.city = customer.city
UNION
SELECT salesman_id, name, 'NO MATCH', commission
FROM salesman
WHERE NOT city = ANY (SELECT city FROM customer) ORDER BY 2 DESC ;



Q27. From the following table, write a SQL query to create a union of two queries that shows the customer id,

Answer:
select customer_id,city,grade,'High rating'
from customer where grade >= 300
union
select customer_id,city,grade,'Low rating'
from customer where grade < 300  ;



Q28. Write a Oracle SQL query to get the employee no, first name and last name for those employees who are earning commission.

Answer:
select employee_id,first_name,last_name,commission_pct from hr.employees
where commission_pct is not null ;  --we can not use '=' with null values function.



Q29. WSQ to get employee details who are join before 2006

Answer:
select * from hr.employees
where hire_date <= to_date('2006', 'YYYY' ) ;  --we need to give date formate



Q30. show the record of employees whos manager id is 100.

Answer:
select * from hr.employees
where manager_id = 100 ;



Q31. find employees whos hire date before 2006, manager_id = 100, also salary greter than 10000

Answer:
select * from hr.employees
where hire_date <= to_date('2006', 'YYYY' ) and manager_id = 100 and  salary > 10000 ;



Q32. find employess whos salary in 10000 to 30000 and manager_id greater than 140

Answer:
select * from hr.employees
where salary in (10000, 30000) and manager_id > 140 ;



Q33. Write a Oracle SQL query to get the maximum salary being paid to department ID.

Answer:
select department_id, max(salary)
from hr.employees
group by department_id;



Q34. Write a Oracle SQL query to get the designations (jobs) along with the total salary for those

Answer:
select job_id, sum(salary) from hr.employees
group by job_id
having sum(salary) > 50000;



Q35. Write a Oracle SQL query to get the designations (jobs) along with the total salary

Answer:
select job_id, count(employee_id) from hr.employees
group by job_id
having count(employee_id) > 3;



Q36. Write a Oracle SQL query to get the department number with more than 10 employees in each department.

Answer:
select department_id,count(*)
from hr.employees
group by department_id
having count(employee_id) > 10;



Q37. Find the Total and Average Salary per Department

Answer:
select sum(salary),avg(salary),department_id from hr.employees
group by department_id ;



Q38. Count the Number of Employees in Each Job Role

Answer:
select count(*) ,job_id from hr.employees
group by job_id ;



Q39. Find the Highest, Lowest, and Average Salary in the Company

Answer:
select round(avg(salary)), min(salary), max(salary)
from hr.employees



Q40. Find the Department with the Highest Average Salary

Answer:
select * from (
select avg(salary), department_id
from hr.employees
group by department_id
ORDER BY avg(salary) DESC )
where rownum = 1;



Q41. 01 Write an SQL query to fetch all employees whose salary is greater than 50,000.

Answer:
select * from hr.employees where salary > 50000 ;



Q42. 02 Write an SQL query to fetch all employees working in the "IT" department.

Answer:
select * from hr.employees e
join hr.departments d
on e.department_id = d.department_id
where department_name = 'IT'  ;



Q43. 03 Write an SQL query to fetch employee names and their departments.

Answer:
select first_name,last_name,department_name from hr.employees e
join hr.departments d
on e.department_id = d.department_id ;



Q44. 04 Write an SQL query to fetch the top 3 highest

Answer:
select * from (
select max(salary) from hr.employees order by salary desc )
where rownum <= 3 ;



Q45. 05 Write an SQL query to fetch employees whose names start with the letter "A".

Answer:
select * from hr.employees
where first_name like 'A%' ;



Q46. 06 Write an SQL query to fetch employees who were hired in the year 2022.

Answer:
select * from hr.employees
where hire_date = to_date('2022', 'YYYY');



Q47. 07 Write an SQL query to count the total number of employees in each department.

Answer:
select department_id,count(*) from hr.employees
group by department_id ;



Q48. 08 Write an SQL query to find the average salary of employees in the "Finance" department.

Answer:
select avg(salary),e.department_id,d.department_name from hr.employees e
join hr.departments d
on e.department_id = d.department_id
group by e.department_id ,d.department_name
having d.department_name = 'Finance' ;

SELECT AVG(e.salary) AS avg_salary, e.department_id
FROM hr.employees e
JOIN hr.departments d ON e.department_id = d.department_id
WHERE d.department_name = 'Finance'
GROUP BY e.department_id;



Q49. 09 Write an SQL query to fetch employees with salaries between 30,000 and 60,000.

Answer:
select * from hr.employees
where salary between 30000 and 60000 ;



Q50. 10 Write an SQL query to fetch all employees who do not belong to the "Human Resources" department.

Answer:
select e.* from hr.employees e
join hr.departments d
on e.department_id = d.department_id
where department_name not in 'Human Resources' ;



Q51. 11 Write an SQL query to fetch the details of employees who have not been assigned a department (NULL department).

Answer:
select * from hr.employees
where department_id is null ;



Q52. 12 Write an SQL query to fetch employee details sorted by their salaries in descending order.

Answer:
select * from hr.employees
order by salary desc ;



Q53. 13 Write an SQL query to fetch duplicate employee names from the employee table.

Answer:
select count(*),first_name from hr.employees
group by first_name
having count(*) >= 2 ;



Q54. 14 Write an SQL query to fetch the department name and the highest salary in each department.

Answer:
select max(salary),department_name from hr.employees e
join hr.departments d
on e.department_id = d.department_id
group by department_name ;



Q55. 15 Write an SQL query to update the salary of employees in the "IT" department by 10%.

Answer:
UPDATE hr.employees e
SET e.salary = e.salary * 1.10
WHERE e.department_id = (            --not solve
    SELECT d.department_id
    FROM hr.departments d
    WHERE d.department_name = 'IT'
);



Q56. 16 Write an SQL query to delete employees whose salaries are below 20,000.

Answer:
delete from hr.employees
where salary < 20000 ;



Q57. 17 Write an SQL query to insert a new employee into the table.

Answer:
insert into hr.employees values(207,'Mical','Fay','MFAY',345.345.555,to_date('04-04-2025','DD-MM-YYYY'),50000,0.25,50,40);



Q58. 18 Write an SQL query to fetch employees whose names contain the substring "John".

Answer:
select * from hr.employees
where first_name like '%John%' ;



Q59. 19 Write an SQL query to fetch employees whose email IDs end with "@company.com".

Answer:
select * from hr.employees
where email like '%@company.com' ;



Q60. 20 Write an SQL query to find the total salary paid to employees in each department.

Answer:
select sum(salary),department_id from hr.employees
group by department_id ;



Q61. 21 Write an SQL query to fetch the employee with the second

Answer:
select max(salary) from hr.employees
where salary < (select max(salary) from hr.employees );



Q62. 22 Write an SQL query to fetch the number of employees hired in each year.

Answer:
select count(*),hire_date from hr.employees
group by hire_date = todate          --not solved
having hire_date = to_date(

SELECT EXTRACT(YEAR FROM hire_date) AS hire_year,
       COUNT(*) AS employee_count
FROM hr.employees
GROUP BY EXTRACT(YEAR FROM hire_date)
ORDER BY hire_year;



Q63. 23 Write an SQL query to fetch employees who share the same salary as another employee.

Answer:
SELECT e1.*
FROM hr.employees e1
JOIN hr.employees e2
ON e1.salary = e2.salary    --not solve
AND e1.employee_id <> e2.employee_id
ORDER BY e1.salary;



Q64. 24 Write an SQL query to fetch employees along with their managers name (using self

Answer:
select e.employee_id,e.first_name || e.last_name ,m.first_name || m.last_name
from hr.employees e, hr.employees m
where e.manager_id = m.employee_id ;



Q65. 26 Write an SQL query to find the maximum and minimum salary of employees.

Answer:
select max(salary),min(salary) from hr.employees ;



Q66. 27 Write an SQL query to fetch employees who were hired in the last 6 months.

Answer:
SELECT employee_id, first_name, last_name, hire_date
FROM hr.employees
WHERE hire_date >= ADD_MONTHS(SYSDATE, -6);



Q67. 28 Write an SQL query to fetch the employees who have worked for more than 5 years.

Answer:
select employee_id, first_name, last_name, hire_date
from hr.employees
where months_between(sysdate, hire_date) > 60;



Q68. 29 Write an SQL query to fetch all employees who do not have a manager assigned.

Answer:
select employee_id, first_name, last_name, manager_id
from hr.employees
where manager_id is null;



Q69. 30 Write an SQL query to fetch the first name, last name, and full name of employees.

Answer:
select first_name,last_name,first_name || ' ' || last_name as full_name from hr.employees ;



Q70. 31 Write an SQL query to fetch employees grouped by department and sorted by the total salary in descending order.

Answer:
select department_id,sum(salary) from hr.employees
group by department_id
order by sum(salary) desc ;



Q71. 32 Write an SQL query to fetch all employees whose salaries are more than the average salary.

Answer:
select * from hr.employees
where salary > (select avg(salary) from hr.employees ) ;


/*I want to show employee details with salary having greater than 10 thousand also department_id should be less than 90
along with employee job description
and department description and the country of that employee*/

select e.*, j.job_title, d.department_name, c.country_name
  from hr.employees e
  join hr.departments d
    on e.department_id = d.department_id
  join hr.jobs j ------------------------------inner join
    on j.job_id = e.job_id
  join hr.locations l
    on l.location_id = d.location_id
  join hr.countries c
    on c.country_id = l.country_id
 where e.salary > 10000
   and e.department_id < 90;



Q72. Get a list of employees and their department names, but only for those working in department_id 60 or 80.

Answer:
select first_name ,last_name ,department_name from hr.employees e
inner join hr.departments d
on e.department_id = d.department_id
where e.department_id in (60 , 80) ;

select first_name, last_name, department_name
from hr.employees e, hr.departments d
where e.department_id = d.department_id
and e.department_id in (60, 80);



Q73. Show employee first name, last name, and their job title, but only for employees earning more than 10000.

Answer:
select first_name ,last_name ,job_title from hr.employees e
inner join hr.jobs s
on e.job_id = s.job_id
where  salary > 10000 ;

select first_name, last_name, job_title
from hr.employees e, hr.jobs s
where e.job_id = s.job_id
and salary > 10000;



Q74. Display all departments along with their location city and postal code.

Answer:
select department_name, city, postal_code from hr.departments d
inner join hr.locations l
on d.location_id = l.location_id ;

select department_name, city, postal_code
from hr.departments d, hr.locations l
where d.location_id = l.location_id;



Q75. List employees with their country name, only for employees working in the US or Canada.

Answer:
select first_name ,last_name ,country_name from hr.employees e
inner join hr.departments d
on e.department_id = d.department_id
inner join hr.locations l
on l.location_id = d.location_id
inner join hr.countries c
on l.country_id = c.country_id
where c.country_id in ('US' , 'CA' ) ;

select first_name, last_name, country_name
from hr.employees e, hr.departments d, hr.locations l, hr.countries c
where e.department_id = d.department_id
and d.location_id = l.location_id
and l.country_id = c.country_id
and c.country_id in ('us', 'ca');



Q76. Show department name along with the manager's full name, only if the manager's last name starts with 'K'.

Answer:
select department_name , first_name || ' ' || last_name as full_name from hr.employees e
inner join hr.departments d
on e.manager_id = d.manager_id
where last_name like 'K%' ;

select department_name, first_name || ' ' || last_name as full_name
from hr.employees e, hr.departments d
where e.manager_id = d.manager_id
and last_name like 'k%';



Q77. Display each region name and the count of employees working in that region.

Answer:
select r.region_name , count(employee_id) from hr.employees e
inner join hr.departments d
on e.manager_id = d.manager_id
inner join hr.locations l
on l.location_id = d.location_id
inner join hr.countries c
on l.country_id = c.country_id
inner join hr.regions r
on r.region_id = c.region_id
group by r.region_name ;

select r.region_name, count(employee_id)
from hr.employees e, hr.departments d, hr.locations l, hr.countries c, hr.regions r
where e.manager_id = d.manager_id
and d.location_id = l.location_id
and l.country_id = c.country_id
and c.region_id = r.region_id
group by r.region_name;



Q78. Show department name and count of different job titles, but only if the department has

Answer:
more than 3 job types assigned.

select department_name , count(job_title) from hr.departments d
inner join hr.employees e
on d.department_id = e.department_id
inner join hr.jobs j
on e.job_id = j.job_id
group by department_name
having count(job_title) > 3 ;

select department_name, count(job_title)
from hr.departments d, hr.employees e, hr.jobs j
where d.department_id = e.department_id
and e.job_id = j.job_id
group by department_name
having count(job_title) > 3;



Q79. List all countries in the 'Europe' and 'Asia' regions only.

Answer:
select country_name , region_name from hr.countries c
inner join hr.regions r
on c.region_id = r.region_id
where region_name  in ('Europe' , 'Asia') ;

select country_name, region_name
from hr.countries c, hr.regions r
where c.region_id = r.region_id
and region_name in ('Europe', 'Asia');



Q80. For each job title, show the number of employees, but only include job titles with more than 5 employees.

Answer:
select job_title , count(employee_id) from hr.employees e
inner join hr.jobs j
on e.job_id = j.job_id
group by job_title
having count(employee_id) > 5 ;

select job_title, count(employee_id)
from hr.employees e, hr.jobs j
where e.job_id = j.job_id
group by job_title
having count(employee_id) > 5;



Q81. List all locations with their country and region name, only for locations in cities that start with 'S' or 'B'

Answer:
select location_id, region_name, country_name from hr.locations l
inner join hr.countries c
on l.country_id = c.country_id
inner join hr.regions r
on r.region_id = c.region_id
where l.city like 'S%' or l.city like 'B%' ;

select location_id, region_name, country_name
from hr.locations l, hr.countries c, hr.regions r
where l.country_id = c.country_id
and c.region_id = r.region_id
and (l.city like 's%' or l.city like 'b%');



Q82. List all departments and the employees in them, including departments that have no employees.

Answer:
select first_name, last_name, d.department_name from hr.departments d
left join hr.employees e on e.department_id = d.department_id;



Q83. Show all employees and their managers full names, even if the manager information is missing.

Answer:
SELECT
    e.first_name AS employee_first_name,
    e.last_name AS employee_last_name,
    m.first_name || ' ' || m.last_name AS manager_full_name
FROM hr.employees e
LEFT JOIN hr.employees m
    ON e.manager_id = m.employee_id;

    select emp.first_name  , emp.last_name, concat( man.first_name, man.last_name) AS manager_full_name from hr.employees emp
left outer join hr.employees man
on man.employee_id = emp.manager_id ;



Q84. List all job titles and the employees assigned to them, even if no employee currently holds a certain job.

Answer:
select job_title, first_name, last_name from hr.jobs s
left join hr.employees e
on s.job_id = e.job_id ;



Q85. Display all countries and the departments located in them, even if a country has no department assigned.

Answer:
select country_name, department_name from hr.countries c
left join hr.locations l
on c.country_id = l.country_id
left join hr.departments d
on l.location_id = d.location_id ;



Q86. Show all locations and the departments at each location, including locations that currently have no departments

Answer:
select city, department_name from hr.locations l
left join hr.departments d
on l.location_id = d.location_id ;



Q87. List all employees and the department names they belong to, but include employees even

Answer:
select first_name, last_name, department_name from hr.employees e
left join hr.departments d
on e.department_id = d.department_id ;



Q88. Get a list of all regions and the countries within them, even if the region has no countries assigned.

Answer:
select region_name, country_name from hr.regions r
left join hr.countries c
on r.region_id = c.region_id ;



Q89. Show all managers and the departments they manage, including managers who are not managing any department.

Answer:
select first_name ||' '|| last_name as manager_name ,department_name from hr.employees e
left join hr.departments d
on e.manager_id = d.manager_id ;

select first_name ||' '|| last_name as manager_name ,department_name from hr.employees e
left join hr.departments d                   --correct
on e.employee_id = d.manager_id ;



Q90. Display all job titles and the average salary of employees in each, even if no one currently has that job

Answer:
select job_title, avg(salary) from hr.jobs j
left join hr.employees e
on j.job_id = e.job_id
group by job_title ;



Q91. List all employees and the cities of their departments, even if some employees are not

Answer:
select first_name, last_name, city from hr.employees e
left join hr.departments d
on e.department_id = d.department_id
left join hr.locations l
on l.location_id = d.location_id ;



Q92. List all employees along with their department names, including departments that have no employees.

Answer:
select first_name, last_name, department_name from hr.employees e
right join hr.departments d
on e.department_id = d.department_id ;



Q93. Show all job titles and the employees holding them, including job titles that are not currently

Answer:
assigned to any employee.

select job_title, first_name, last_name from hr.employees e
right join hr.jobs j
on j.job_id = e.job_id ;



Q94. Display all countries and the departments located in them, including countries that have no departments.

Answer:
select country_name, department_name from hr.departments d
right join hr.locations l
on d.location_id = l.location_id
right join hr.countries c
on c.country_id = l.country_id ;



Q95. List all locations and the departments at those locations, including locations without any departments.

Answer:
select l.city, department_name from hr.departments d
right join hr.locations l
on d.location_id = l.location_id ;



Q96. Show all departments and the managers assigned to them, including departments that currently don’t have a manager

Answer:
select department_name, first_name ||' '|| last_name as manager_name from hr.employees e
right join hr.departments d
on e.department_id = d.manager_id ;



Q97. Display all employees and their managers’ names, including employees who are not managed by anyone.

Answer:
select e.first_name || ' ' || e.last_name as employee_name ,
       b.first_name || ' ' || b.last_name as manager_name from hr.employees b
       right join  hr.employees e
       on b.manager_id = e.employee_id ;



Q98. List all countries and the cities they contain, including countries without any cities (locations).

Answer:
select country_name, city from hr.locations l
right join hr.countries c
on c.country_id = l.country_id ;



Q99. Get all employees and the job details, even if the job info is missing (maybe due to incorrect job_id).

Answer:
select first_name, last_name, job_title from hr.employees e
right join hr.jobs j
on e.job_id = j.job_id ;



Q100. Show all regions and the countries in them, even if some countries are not assigned to any region.

Answer:
select region_name, country_name
from hr.countries c
right join hr.regions r
on c.region_id = r.region_id;



Q101. Display all departments and the employees working in them, even if an employee is not assigned to any department.

Answer:
select department_name, first_name, last_name
from hr.employees e
right join hr.departments d
on e.department_id = d.department_id;



Q102. List all employees and departments, including employees not assigned to any department and departments

Answer:
select first_name, last_name, department_name from hr.employees e
full join hr.departments d
on e.department_id = d.department_id ;



Q103. Show all jobs and employees, including jobs with no employees and employees with invalid job IDs.

Answer:
select first_name, last_name, job_title from hr.employees e
full join hr.jobs j
on e.job_id = j.job_id ;



Q104. Display all departments and their managers, even if a department has no manager or a manager

Answer:
is not assigned to a department

select department_name, first_name||' '||last_name as manager_name from hr.employees e
full join hr.departments d
on e.employee_id = d.manager_id ;



Q105. has an invalid country reference.

Answer:
select country_name, l.city from hr.locations l
full join hr.countries c
on l.country_id = c.country_id ;



Q106. Show all employees and their managers’ names, even if an employee has no manager or

Answer:
select a.first_name ||' '|| a.last_name as employee_name ,
       b.first_name ||' '|| b.last_name as manager_name from hr.employees a
       full join hr.employees b
       on a.manager_id = b.employee_id ;



Q107. some countries have invalid region IDs.

Answer:
select region_name, country_name from hr.countries c
full join hr.regions r
on c.region_id = r.region_id ;



Q108. Display all locations and departments, including locations with no departments and

Answer:
select city, department_name from hr.departments d
full join hr.locations l
on d.location_id = l.location_id ;



Q109. Show all employees and job history records, including employees with no history and

Answer:
select first_name, last_name, j.* from hr.employees e
full join hr.job_history j
on e.employee_id = j.employee_id ;



Q110. List all departments and job titles, even if some job titles aren’t assigned in the department or vice versa.

Answer:
select department_name, job_title from hr.departments d
full join hr.employees e
on d.department_id = e.department_id
full join hr.jobs j
on e.job_id = j.job_id ;



Q111. Find employees who earn more than the average salary of all employees.

Answer:
select first_name, last_name, salary from hr.employees
where salary > (select avg(salary) from hr.employees ) ;



Q112. Display departments located in the same location as department 90.

Answer:
select d.department_name, location_id from hr.departments d
where location_id = (select location_id from hr.departments where department_id = 90 ) ;



Q113. Display departments and there city located in the same location as department 90.

Answer:
select d.department_name, d.location_id, l.city from hr.departments d
inner join hr.locations l
on d.location_id = l.location_id
where d.location_id = (select location_id from hr.departments where department_id = 90 ) ;



Q114. List employees who have the same job as employee ID 105.

Answer:
select * from hr.employees
where job_id = (select job_id from hr.employees where employee_id = 105 ) ;



Q115. Show job titles where the minimum salary is less than the average salary of all employees.

Answer:
select job_title,min_salary from hr.jobs
where min_salary < (select avg(salary) from hr.employees );



Q116. Find employees who work in the same department as employee ID 100.

Answer:
select * from hr.employees
where department_id = (select department_id from hr.employees where employee_id = 100 );



Q117. List all countries that belong to the same region as the United States of America.

Answer:
select country_name,region_id from hr.countries
where region_id = ( select region_id from hr.countries where country_name = 'United States of America' ) ;


-- Identify jobs where the maximum salary is higher than the max salary of the 'IT_PROG' job.
select * from hr.jobs
where max_salary > (select max_salary from hr.jobs where job_id = 'IT_PROG');



Q118. Find employees hired after the earliest hire date in the company.

Answer:
select * from hr.employees
where hire_date > (select min(hire_date) from hr.employees) ;



Q119. Display departments located in the city of Toronto.

Answer:
select * from hr.departments
where location_id = (select location_id from hr.locations where city = 'Toronto') ;



Q120. Show the region name where the country 'China' is located.

Answer:
select region_name from hr.regions
where region_id = (select region_id from hr.countries where country_name = 'China' ) ;



Q121. List employees who earn more than the average salary of their own department.

Answer:
select e.first_name , e.last_name, e.salary, e.department_id from hr.employees e
where e.salary > (select avg(e1.salary) from hr.employees e1
                 where e.department_id = e1.department_id) ;



Q122. Show employees whose hire date is earlier than the hire date of their manager.

Answer:
select e.first_name, e.last_name, e.hire_date, e.manager_id from hr.employees e
where e.hire_date < (select e1.hire_date from hr.employees e1
                     where e.manager_id = e1.employee_id ) ;



Q123. Display employees who earn more than any other employee in the same job.

Answer:
select e.first_name, e.last_name, e.salary from hr.employees e
where e.salary > ( select max(e1.salary) from hr.employees e1
                   where e1.job_id = e.job_id and e.employee_id != e1.employee_id ) ;

                   select * from hr.employees ;



Q124. List departments where the number of employees is greater than 5.

Answer:
select e.department_id from hr.employees e
where e.department_id > (select e1.department_id from hr.employees e1
                        where  e.department_id = e1.department_id and count(e1.employee_id) > 5 ) ;

select department_name
from hr.departments d
where (
  select count(*)            --correct
  from hr.employees e
  where e.department_id = d.department_id
) > 5;



Q125. Find employees who are the only person in their department.

Answer:
select e.first_name, e.last_name from hr.employees e
where  (select count(e1.employee_id) from hr.employees e1
        where e.department_id = e1.department_id ) = 1 ;



Q126. Show employees whose salary is the highest in their department.

Answer:
select e.first_name, e.last_name, e.salary from hr.employees e
where e.salary = (select max(e1.salary) from hr.employees e1
                   where e.department_id = e1.department_id ) ;



Q127. List employees who have the lowest salary in their job.

Answer:
select e.first_name, e.last_name, e.salary from hr.employees e
where e.salary = (select min(e1.salary) from hr.employees e1
                   where e.job_id = e1.job_id ) ;



Q128. Display employees whose commission is greater than their department’s average commission.

Answer:
select e.first_name, e.last_name, e.salary
from hr.employees e
where e.commission_pct > (
select avg(e1.commission_pct)
from hr.employees e1
where e.department_id = e1.department_id ) ;

select e.first_name, e.last_name, e.commission_pct
from hr.employees e
where e.commission_pct is not null
  and e.commission_pct > (                     ---Handles null
    select avg(e1.commission_pct)
    from hr.employees e1
    where e1.department_id = e.department_id
      and e1.commission_pct is not null
  );



Q129. Find departments where all employees earn more than 5000.

Answer:
select distinct e.department_id
from hr.employees e
where not exists (
    select 1
    from hr.employees e1
    where e1.department_id = e.department_id
      and e1.salary <= 5000
);

select distinct e.department_id, d.department_name
from hr.employees e
join hr.departments d on e.department_id = d.department_id
where not exists (
    select 1
    from hr.employees e1
    where e1.department_id = e.department_id
      and e1.salary <= 5000
);



Q130. List jobs where the maximum salary is more than any employee’s salary in that job.

Answer:
select j.job_id, j.job_title
from hr.jobs j
where j.max_salary > (
    select max(e.salary)
    from hr.employees e
    where e.job_id = j.job_id
);


-- Rank employees based on salary within each department.
select first_name, last_name, rank() over (partition by department_id order by salary ) from hr.employees ;



Q131. Show employees salaries along with the average salary of their department.

Answer:
select
       first_name,
       last_name,
       salary,
       avg(salary) over (partition by department_id) as avg_dpt_sal
from
       hr.employees ;



Q132. Display employees with their salary and the highest salary in their department.

Answer:
select
       first_name,
       last_name,
       salary,

       hr.employees ;



Q133. List employees with their hire date and the number of days since the last hire in their department.

Answer:
select
       first_name,
       last_name,
       hire_date,
       hire_date - lag(hire_date) over (partition by department_id order by hire_date) as days_since_last_hire
from
    hr.employees;



Q134. Show employees along with their cumulative salary in their department (ordered by salary).

Answer:
select
       first_name,
       last_name,
       salary,
       sum(salary) over (partition by department_id order by salary) as sum_dpt_sal
from
       hr.employees ;



Q135. Display each employee’s salary and the difference from the department’s average salary.

Answer:
select
       first_name,
       last_name,
       salary,
       salary - avg(salary) over (partition by department_id ) as avg_dpt_sal
from
       hr.employees ;



Q136. For each department, show the first and last employee hired.

Answer:
select
       first_name,
       last_name,
       min(hire_date) over (partition by department_id order by  department_id asc ) as min_hire_date
from
       hr.employees ;

select
    department_id,
    first_name,
    last_name,
    hire_date,
    first_value(first_name || ' ' || last_name) over (
        partition by department_id                  --first_value,last_value is the analytical functions in
        order by hire_date                          --Oracle SQL that let you look at values from other rows
    ) as first_hired,                               --within a group (partition).
    last_value(first_name || ' ' || last_name) over (
        partition by department_id
        order by hire_date
        rows between unbounded preceding and unbounded following
    ) as last_hired
from
    hr.employees;



Q137. List employees and their row number based on salary descending within their job.

Answer:
select
       first_name,
       last_name,
       row_number() over (order by salary desc) as row_num
from
       hr.employees ;


-- Rank employees across the entire company based on hire date.
select
       first_name,
       last_name,
       hire_date,
       rank() over (order by hire_date )
from
       hr.employees ;



Q138. Show the percentage contribution of each employees salary to their departments total salary.

Answer:
select
    first_name,
    last_name,
    department_id,
    salary,
    round((salary / sum(salary) over (partition by department_id)) * 100, 2) as contribution_percent
from
    hr.employees;



Q139. Get employees who earn more than the average salary of their department using HR.EMPLOYEES and HR.DEPARTMENTS.

Answer:
select e.first_name, e.last_name, e.department_id, e.salary
  from hr.employees e
  join (
      select department_id, avg(salary) as avg_salary
      from hr.employees
      group by department_id
  ) dept_avg
  on e.department_id = dept_avg.department_id
  where e.salary > dept_avg.avg_salary;



Q140. Show CLIENT_NAME, total quantity.

Answer:
select c.client_name, sum(quantity) as total_quentity
  from clients c
  join sales s
    on c.client_id = s.client_id
 group by c.client_name
 order by total_quentity desc;



Q141. Show CLIENT_NAME and average order value.

Answer:
select c.client_name, round(avg(quantity*price),2) as avg_order_value
  from clients c
  join sales s
    on c.client_id = s.client_id
  join items i
    on i.item_id = s.item_id
 group by c.client_name
 order by avg_order_value desc;



Q142. Show ITEM_NAME, total quantity sold.

Answer:
select i.item_name, sum(quantity) as quantity_sold
    from items i
    join sales s
      on i.item_id = s.item_id
   group by i.item_name
  having sum(quantity) > 5;


-- Analytical Functions (OVER / RANK / ROW_NUMBER / LEAD / LAG)



Q143. : For each client, assign a rank based on total purchase amount.

Answer:
SELECT client_id,
       client_name,
       pur_amt,
       RANK() OVER (ORDER BY pur_amt DESC) AS rn
FROM (
      SELECT c.client_id,
             c.client_name,
             SUM(i.price * s.quantity) AS pur_amt
      FROM clients c
      JOIN sales s ON c.client_id = s.client_id
      JOIN items i ON s.item_id = i.item_id
      GROUP BY c.client_id, c.client_name
     );



Q144. : For each client, show their last 3 purchases by SALE_DATE.

Answer:
select client_name, sale_id, item_name, sale_date, quantity, rn
  from (select c.client_name,
               s.sale_id,
               i.item_name,
               sale_date,
               quantity,
               row_number() over(partition by client_name order by sale_date desc) as rn
          FROM clients c
          JOIN sales s
            ON c.client_id = s.client_id
          JOIN items i
            ON s.item_id = i.item_id)
 where rn <= 3
 order by client_name;



Q145. : Show for each client the current sale amount and previous sale amount (based on SALE_DATE).

Answer:
select client_name,
       sale_date,
       current_amt,
       lag(current_amt) over(partition by client_name order by sale_date)
  from (select c.client_name,
               sale_date,
               (i.price * s.quantity) AS current_amt
          FROM clients c
          JOIN sales s
            ON c.client_id = s.client_id
          JOIN items i
            ON s.item_id = i.item_id);

select c.client_name,
       sale_date,
       (i.price * s.quantity) AS current_amt,
       lag(i.price * s.quantity) over(partition by client_name order by sale_date)
  FROM clients c
  JOIN sales s
    ON c.client_id = s.client_id
  JOIN items i
    ON s.item_id = i.item_id;


-- Joins (INNER / LEFT / RIGHT / FULL / CROSS)



Q146. : List all sales with client and item details.

Answer:
select c.client_name, s.sale_id, i.item_name, sale_date, quantity
  FROM clients c
  JOIN sales s
    ON c.client_id = s.client_id
  JOIN items i
    ON s.item_id = i.item_id;



Q147. : List all clients and their total number of orders, including clients who never placed an order.

Answer:
select client_name, count(sale_id) as total_orders
  from clients c
  left join sales s
    on c.client_id = s.client_id
 group by client_name;



Q148. : List all items and total quantity sold, including items never sold. grand total of quantity

Answer:
select nvl(item_name, 'Total'), sum(quantity) as TOTAL_QUANTITY
  from items i
 left join sales s
    on i.item_id = s.item_id
 group by rollup(item_name);



Q149. Show CLIENT_NAME, ITEM_NAME, COUNT(*)

Answer:
select client_name,  count(s.item_id)
  from clients c
  join sales s
    on c.client_id = s.client_id
  join items i
    on s.item_id = i.item_id
 group by client_name
having count(s.item_id) > 1;



Q150. Show: CLIENT_NAME and total purchased quantity.

Answer:
select client_name, sum(quantity) as total_purchase_Q
  from clients c
  join sales s
    on c.client_id = s.client_id
 group by client_name
having sum(quantity) > (select avg(total_qty)
                          from (select sum(quantity) as total_qty
                                  from sales
                                 group by client_id));



Q151. Show: ITEM_NAME and CATEGORY.

Answer:
select item_name, category
  from items i
 where not exists (select 1 from sales s where i.item_id = s.item_id);



Q152. Write a Oracle SQL query to get the employee no, first name and last name for those employees who are earning commission.

Answer:
select last_name, first_name, phone_number, commission_pct
from hr.employees
where commission_pct is not null;



Q153. Write a Oracle SQL query to get the employee id, first_name and last_name

Answer:
select employee_id, first_name, last_name,commission_pct
from hr.employees
where commission_pct is null;



Q154. Write a Oracle SQL query to get the the first_name and last_name of the employees who are

Answer:
select first_name, last_name from hr.employees
where job_id = 'ST_CLERK' OR job_id = 'SA_MAN' OR job_id='IT_PROG'
and salary > 3000 ;



Q155. Write a Oracle SQL query to get the first_name and last_name, job_id, department_id of the employees who

Answer:
select first_name, last_name, job_id, department_id from hr.employees
where department_id in(10,20,40) or job_id in('ST_CLERK','SA_MAN','IT_PROG');



Q156. Write a Oracle SQL query to get the first_name and last_name of the employees whose first_name are exactly five characters in length.

Answer:
select first_name, last_name from hr.employees
where length(first_name)=5;



Q157. Write a Oracle SQL query to get the the first_name and last_name of the employees who are not working as 'AC_MGR'.

Answer:
select first_name, last_name from hr.employees
where job_id != 'AC_MGR';



Q158. Write a Oracle SQL query to get the the first_name and last_name of the employees who are not working as 'ST_CLERK', 'SA_MAN' or 'IT_PROG'.

Answer:
select first_name, last_name from hr.employees
where job_id not in ('ST_CLERK', 'SA_MAN', 'IT_PROG');



Q159. Write a Oracle SQL query to get the maximum salary being paid to 'ST_CLERK'.

Answer:
select job_id, max(salary) from hr.employees
group by job_id
having job_id = 'ST_CLERK' ;

SELECT max(salary) as "Maximum Salary" from hr.employees where job_id='ST_CLERK';



Q160. Write a Oracle SQL query to get the minimum salary being paid to SA_MAN.

Answer:
select min(salary) from hr.employees
where job_id = 'SA_MAN';



Q161. Write a Oracle SQL query to get the total salary drawn by 'SA_MAN' working in the department number 80.

Answer:
select sum(salary) from hr.employees
where job_id = 'SA_MAN' and department_id = 80;



Q162. WAQ to display department from dept table those dept having employees in emp table by using corelated subquery exists operator.

Answer:
select * from dept d where exists(select * from emp where deptno=d.deptno);



Q163. WAQ to display those deptment from dept table having employees in emp table by using non

Answer:
select * from dept where deptno in (select deptno from emp);

-- Note:
-- Exists operator performance is very high compare to in operator.
-- Difference between in,exists operator?
-- eg:
-- dept
-- emp

-- in operator:
select * from dept where deptno in (select deptno from emp);
-- Execution:
-- All rows in emp table will read for every row in dept table
-- i.e,oracle server reads 1000000 rows from emp table.

-- exists operator:
select * from dept d where exists (select * from emp where deptno=d.deptno);
-- Execution:
-- A maximum of one row will be read for emp table for each row in dept table
-- i.e, it reduces processing statement then improve performance of the query.



Q164. query, exists operator.

Answer:
select * from emp e1 where exists (select * from emp e2 where e1.sal=e2.sal and e2.ename='SCOTT');



Q165. WAQ to display those department from dept table does not have a employee in emp table by using corelated subquery?

Answer:
select * from dept d where not exists (select * from emp where deptno=d.deptno );



Q166. WAQ to display those dept from dept table doesnt have employee in emp table by using non

Answer:
select * from dept where deptno not in (select deptno from emp);

-- Generally not in operator doesnt work with null values in place of this one we can also
-- use not exists operator by using corelated subquery.
-- eg:
insert into emp (empno,deptno)values(10,null);
select * from emp;
select * from dept where deptno not in (select deptno from emp); --no row selected

select * from dept d where not exists (select * from emp where deptno=d.deptno);
rollback;

delete from emp where rowid not in(select min(rowid) from emp group by empno);

-- ALL,ANY subquery special operators used in non



Q167. WAQ to display the employees who are getting more salary than the highest paid employees in 20th dept from emp table?

Answer:
select * from emp where sal>(select max(sal) from emp where deptno=20);



Q168. WAQ to display the employees who are getting more salary than the lowest paid employees in 10th dept from emp table?

Answer:
select * from emp where sal>(select min(sal) from emp where deptno=10);


-- whenever resource table column having duplicate data then the above query doesnt return any row.



Q169. To overcome this problem then we must use distinct clouse within count() function.

Answer:
insert into test values('AAA',200);
select * from test;
select * from test t1 where 2 =(select count(*) from test t2 where t2.sal>=t1.sal); --no rows selected
-- solution:
select * from test t1 where 2 = (select count(distinct(sal)) from test t2 where t2.sal>=t1.sal)



Q170. WAQ to display 2nd highest salary employee from the above table by using corelated subquery (n

Answer:
select * from test t1 where (2-1) = (select count(distinct(sal)) from test t2 where t2.sal>t1.sal);



Q171. WAQ to display nth highest salary employee from the emp table by using corelated subquery?

Answer:
select * from emp e1 where &n=(select count(distinct(sal)) from emp e2 where e2.sal>e1.sal);



Q172. WAQ to display the employees who are getting more salary than the avg(sal) of their jobs from emp table by using corelated subquery?

Answer:
select * from emp e where sal>(select avg(sal) from emp where job=e.job);



Q173. WAQ to display 1st highest salary employee from emp table by using co

Answer:
select * from hr.employees e1 where 1 = (select count(*) from hr.employees e2 where e2.salary>=e1.salary);



Q174. WAQ to display 2nd highest salary employee from the following table by using corelated subquery?

Answer:
select * from hr.employees e1 where 2 = (select count(distinct(salary)) from hr.employees e2 where e2.salary>=e1.salary);



Q175. WAQ to display 2nd row from emp table by using analytical function,rowid?

Answer:
select * from (select emp.*,row_number() over (order by rowid) r from emp) where r=2;



Q176. WAQ to display last two records from employee table by using analytical function and rowid?

Answer:
select * from (select rownum,emp.*, row_number()over(order by rowid desc) r from emp)where r<=2;



Q177. WAQ to display first row from emp table by using rowid

Answer:
select emp.*,rownum,rowid from emp where rowid=(select min(rowid)from emp);



Q178. WAQ to display last row from emp table by using rowid?

Answer:
select * from emp where rowid = (select max(rowid) from emp);



Q179. WAQ to display the employee details highest salary to lowest salary and also automatically

Answer:
select * from (select emp.*,row_number() over (partition by deptno order by sal desc) r,
rank() over (partition by deptno order by sal desc) rnk,
dense_rank() over (partition by deptno order by sal desc) drnk
from emp); --where r <= 10;



Q180. write a query to display 2nd highest salary employee in each dept from emp table by using analytical function?

Answer:
select * from (select emp.*, dense_rank()over (partition by deptno order by sal desc) r from emp)where r=2;



Q181. WAQ to display 5th highest salary employee from emp table by using analytical function?

Answer:
select * from (select emp.*,dense_rank() over (order by sal desc) r from emp) where r = 5;

-- note:
-- In analytical fucntion partition by clouse is an optional clouse.



Q182. WAQ to display nth hifgest salary employee from emp table by using analytical function?

Answer:
select * from(select emp.*,dense_rank() over (order by sal desc) r from emp) where r=&n;



Q183. WAQ to display 2nd row from emp table by using rownum alias name?

Answer:
select * from (select rownum r,emp.* from emp) where r=2;



Q184. to display all columns:

Answer:
select * from (select rownum r,emp.* from emp)where r=2;



Q185. WAQ to display rows between 3 to 7 from emp table by using rownum aliasname.

Answer:
select * from (select rownum r,ename,sal from emp)where r between 3 and 7;



Q186. WAQ to display 2nd,3rd,7th,10th records from emp table by using rownum alias name.

Answer:
select * from (select rownum r,ename,sal from emp)where r in (2,3,7,10);

-- WAQ to dispaly 1st row,last row from emp table by using rownum aliasname.
select * from(select rownum r,ename,sal from emp)where r = 1 or r =(select count(*) from emp);



Q187. WAQ to display even no. of record from emp table by using rownum aliasname.

Answer:
select * from (select rownum r,ename,sal from emp) where mod(r,2)=0;



Q188. WAQ to display 5th highest salary employee from emp table by using rownum alias name?

Answer:
select * from  (select rownum r,emp.* from emp order by sal desc)where r=5;



Q189. WAQ to display 5th highest salary employee from emp table by using rownum?

Answer:
select * from (select * from emp order by sal desc)where rownum<=5
minus
select * from (select * from emp order by sal desc)where rownum<=4;



Q190. WAQ to display 2nd row from emp table by using row num?

Answer:
select rownum,emp.* from emp where rownum<=2
minus
select rownum,emp.* from emp where rownum<=1;



Q191. WAQ to display rows 1 to 5 from emp table by using rownum?

Answer:
select rownum,emp.* from emp where rownum between 1 and 5;



Q192. WAQ to display rows between 3 to 7 from employee table by using rownum?

Answer:
select rownum,emp.* from emp where rownum <=7
minus
select rownum,emp.* from emp where rownum <=3;



Q193. WAQ to display last two rows from emp table by using rownum?

Answer:
select rownum,emp.* from emp
minus
select rownum,emp.* from emp where rownum<=(select count(*)-2 from emp);



Q194. WAQ to display first row from emp table by using rownum?

Answer:
select rownum,emp.* from emp where rownum=1;



Q195. WAQ to display second row from emp table by using rownum?

Answer:
select * from emp where rownum=2; --no row selected
-- Ganarally rownum doesnt work with more than 1 positive integer it works with <,<= operators.



Q196. write a query to display 1st five row from emp table by using rownum?

Answer:
select rownum,emp.* from emp where rownum<=2;



Q197. WAQ to display first five hifgest salary employee from emp table by using rownum?

Answer:
select * from(select * from emp order by sal desc)where rownum<=5;



Q198. WAQ to display first five highest salary employee from emp table by using rownum?

Answer:
select rownum,emp.* from(select * from emp order by sal desc)where rownum<=5;



Q199. WAQ to display the employees whos job,mgr match with the job,mgr of the employee 'SCOTT' from emp?

Answer:
select * from emp where(job,mgr)in(select job,mgr from emp where ename='Scott');



Q200. Write a mutiple row subquery to display the employee who are getting max sal from each dept from emp table?

Answer:
select * from emp where sal in (select max(sal) from emp group by deptno);
-- OR



Q201. WAQ to dispaly the employees who are getting max sal from each dept from emp table using multiple columns subquery.

Answer:
update emp set sal = 3550 where ename = 'Ford';
rollback;
select * from emp where (deptno,sal) in (select deptno,max(sal) from emp group by deptno);



Q202. WAQ to display ename,dname,sal of the employees whose sal,comm match with the sal,comm f the employees working

Answer:
select ename,dname,sal,loc from emp e ,dept d where e.deptno=d.deptno
and (sal,nvl(comm,0)) in (select sal,nvl(comm,0)from emp e,dept d where e.deptno=d.deptno and loc='DALLAS');



Q203. write a multiple column subquery to display senior most employee in each job from emp table?

Answer:
select * from emp where (job,hiredate) in (select job,min(hiredate) from emp group by job );



Q204. WAQ to display the employee details,who are getting max(sal)in each dept from emp table?

Answer:
select * from emp where sal=(select max(sal) from emp group by deptno); --error
-- This is multiple row subquery because here inner query returns multiple values,
-- In multiple row subquery we need to use 'in' operator in place of  '=' operator.

select * from emp where sal in(select max(sal) from emp group by deptno);



Q205. WAQ to display the employee who are working in 'SALES' or 'RESEARCH' department from dept,emp table by using sub query.

Answer:
select * from emp where deptno in (select deptno from dept where dname='SALES' or dname='RESEARCH');



Q206. Que:WAQ to display the employees who are working in SALES dept from emp,dept table.

Answer:
select * from emp where deptno =(select deptno from dept where dname = 'SALES');



Q207. Que:WAQ to display most senoir employee detail from emp table

Answer:
select * from emp where hiredate=(select min(hiredate) from emp);

-- Note:
-- Generally in all DB we are not allowed to use child query table column with outer query
-- because subquery always returns parent query total column in output, to overcome this problem
-- we must use joins within parent query.
-- eg:
select ename,dname from emp e,dept d where e.deptno=d.deptno
and d.deptno=(select deptno from dept where dname='SALES');



Q208. WAQ to display the employees who are working same as 'smith' deptno from dept table?

Answer:
select * from emp where deptno = (select deptno from emp where ename ='Smith');



Q209. WAQ to display the employee who are getting more salary than the highest paid employee in 20th dept in emp table?

Answer:
select * from emp where sal > (select max(sal) from emp where deptno=20);

-- WAQ to dispaly dname of the highest paid employee from emp,dept table?
select dname from dept where deptno=(select deptno from emp where sal =(select max(sal) from emp ));



Q210. WAQ to display 2nd max salary details from emp table?

Answer:
select max(sal) from emp where sal<(select max(sal) from emp);



Q211. WAQ to display 2nd highest salary details from emp table?

Answer:
select * from emp where sal=(select max(sal) from emp where sal<(select max(sal) from emp));

-- Note:
-- In all databases whenever inner query having nested group function then we must use group by clouse in inner query.



Q212. WAQ to display job,avg salary which job,avg salary more than cleark job avg sal?

Answer:
select job,avg(sal) from emp group by job having avg(sal)>(select avg(sal) from emp where job='CLERK');



Q213. WAQ to display the employees who are warking under 'BLAKE' as manager by using mgr column from emp table?

Answer:
select * from emp where mgr = (select empno from emp where ename='Blake');



Q214. que:WAQ to display the employees who are getting more salary than the avg sal from emp table.

Answer:
select * from emp where sal>(select avg(sal) from emp);



Q215. List all customers with a rating of 100.

Answer:
select * from customerr
where rating = 100;



Q216. Find all records in the Customer table with NULL values in the city column.

Answer:
select * from customerr
where city is null;



Q217. Find the largest order taken by each salesperson on each date.

Answer:
select snum,max(amt)
from orders
group by snum;

-- Arrange the Orders table by descending customer number.

select * from orders
order by cnum;



Q218. Find which salespeople currently have orders in the Orders table.

Answer:
select distinct o.snum,s.sname
from salespeople s
join orders o
on s.snum = o.snum;



Q219. List names of all customers matched with the salespeople serving them.

Answer:
select c.cname,s.snum,s.sname
from customerr c
join salespeople s
on s.snum=c.snum;



Q220. Find the names and numbers of all salespeople who had more than one customer.

Answer:
select s.snum,s.sname from salespeople s
where s.snum in  (select snum from customerr
                       group by snum
                       having count(cnum) > 1 );



Q221. Count the orders of each of the salespeople and output the results in descending order.

Answer:
select snum,count(onum)
from orders
group by snum
order by count(onum) desc;

select s.snum,s.sname,count(o.onum)
from salespeople s
left join orders o
on s.snum = o.snum
group by s.snum,s.sname
order by count(o.onum) desc;



Q222. List the Customer table if and only if one or more of the

Answer:
select * from customerr
where city = 'San Jose';

-- Match salespeople to customers according to what city they lived in.

select s.sname,c.cname,c.city
from salespeople s
join customerr c
on s.city = c.city ;



Q223. Find the largest order taken by each salesperson.

Answer:
select max(amt),snum from orders
group by snum;

select s.snum,s.sname,max(o.amt)
from salespeople s
 join orders o
on s.snum = o.snum
group by s.snum,s.sname;



Q224. Find customers in San Jose who has a rating above 200.

Answer:
select cname, rating from customerr
where city = 'San Jose' and rating > 200;



Q225. List the names and commissions of all salespeople in London.

Answer:
select comm, sname from salespeople
where city = 'London' ;



Q226. List all the orders of salesperson Monika from the Orders table.

Answer:
select onum,amt, odate
from orders where snum = (select snum from salespeople
                          where sname = 'Monika');



Q227. Find all customers with orders on October 3.

Answer:
select cnum from orders
where odate = to_date('03-OCT-2096', 'DD-MON-YYYY');

select c.cname,c.cnum
from customerr c            -- this Q not solve
join orders o
on c.cnum = o.cnum
where o.odate = to_date('03-OCT', 'DD-MON');

-- Give the sums of the amounts from the orders table, grouped by date,

select sum(amt),odate
from orders
group by odate;

-- Eliminating all those dates where the SUM was not at least 2000.00 above the MAX amount.

select sum(amt),odate
from orders
group by odate
having sum(amt) >=2000;



Q228. Find all customers with CNUM, 1000 above the SNUM of Serres.

Answer:
select cnum from customerr
where snum > 1000;

select cnum,cname        --actual ans
from customerr
where cnum = (select snum + 1000 from salespeople
              where sname = 'Serres');

-- Give the salespeople’s commissions as percentage instead of decimal numbers.

select snum,sname,city,(comm * 100) as "percentage commission"
from salespeople;



Q229. Find the largest order taken by each salesperson on each date, eliminating those MAX orders,

Answer:
select s.sname,s.snum,o.odate,max(amt)
from salespeople s
left join orders o
on s.snum = o.snum
group by s.sname,s.snum,o.odate
having max(amt) >= 3000;



Q230. List the largest orders on October 3, for each salesperson.

Answer:
select snum,max(amt),odate --not solve
from orders
where odate = TO_DATE('10-03','MM-DD')
group by snum,odate;



Q231. Find all customers located in cities where Serres (SNUM 1002) has customers.

Answer:
select cname,city from customerr
where snum = (select snum from Salespeople
              where sname = 'Serres');



Q232. Select all customers with a rating above 200.00.

Answer:
select cname from customerr
where rating > 200;



Q233. Count the number of salespeople currently listing orders in the Orders table.

Answer:
select count(distinct snum)as"salesman with orders" from orders;



Q234. Write a query that produces all customers serviced by salespeople with a commission above 12%

Answer:
select c.cname
from customerr c
join salespeople s
on s.snum = c.snum
where comm > 0.12;



Q235. Find salespeople who have multiple customers.

Answer:
select sname from salespeople
where snum in ( select snum from customerr
        group by snum
       having  count(snum) > 1 );



Q236. Find salespeople with customers located in their city.

Answer:
select c.cname, s.sname,s.city
from salespeople s
join customerr c
on s.city = c.city;



Q237. Find all salespeople whose name starts with ‘P’ and the fourth character is ‘I’.

Answer:
select sname from salespeople
where sname like 'P__l%';



Q238. Write a query that uses a sub query to obtain all orders for the customer

Answer:
select onum from orders
where snum in (select snum from customerr
               where cname = 'Cisneros');

select onum from orders
where cnum in (select cnum from customerr
               where  cname = 'Cisneros');



Q239. Find the largest orders for ‘Serres’ and ‘Rifkin’.

Answer:
select max(amt),onum
from orders o
join salespeople s  --not solve
on s.snum = o.snum
group by onum
having s.sname in ('Rifkin', 'Serres');


select o.onum
from orders o
join salespeople s
on s.snum = o.snum
where s.sname in ('Rifkin', 'Serres')
and amt = (select max(amt) from orders where snum = s.snum);

-- Extract the Salespeople table in the following order: SNUM, SNAME, COMMISSION, CITY.

select snum,sname,comm AS Commission,city from salespeople;



Q240. Select all customers whose names fall in between ‘A’ and ‘G’ alphabetical range.

Answer:
select cname from customerr  -----not clear this Q
where cname between 'A' and 'G';



Q241. Select all the possible combinations of customers that you can assign.

Answer:
select * from customerr  -- Q not understand
order by cname;



Q242. Select all orders that are greater than the average for October 4.

Answer:
select onum,odate,avg(amt) from orders
group by onum,odate
having amt > avg(amt);-------not done

select onum,odate,amt from orders
where odate = TO_DATE('10-04', 'MM-DD')
and amt > (select avg(amt) from orders where odate = TO_DATE('10-04', 'MM-DD') );



Q243. Write a query that totals the orders for each day and places the results in descending order.

Answer:
select Odate, sum(amt)
from orders
group by odate
order by sum(amt) desc;



Q244. Write a select command that produces the rating followed by the name of each customer in San Jose.

Answer:
select cname,rating
from customerr
where city = 'San Jose';



Q245. Find all orders with amounts smaller than any amount for a customer in San Jose.

Answer:
select onum,amt from orders
where amt < any (select amt from orders
               where cnum not in (select cnum from customerr where city = 'San Jose') );



Q246. Find all orders with above average amounts for their customers.

Answer:
select onum,avg(amt),cnum
from orders
group by onum,cnum;              -- not solve

select * from orders
where amt > any (select avg(amt) from orders
             group by cnum);



Q247. Write a query that selects the highest rating in each city.

Answer:
select max(rating), city
from customerr
group by city;



Q248. Count the customers with rating above San Jose’s average.

Answer:
select * from customerr
where rating > (select avg(rating) from customerr
                where city = 'San Jose');



Q249. Find all salespeople that are located in either Barcelona or London.

Answer:
select snum,sname,city from salespeople
where city in ('Barcelona', 'London');



Q250. Find all salespeople with only one customer.

Answer:
select snum,sname from salespeople
where snum in (select snum from customerr
               group by snum
               having count(cnum) = 1  );



Q251. Write a query that joins the Customer table to itself to find all

Answer:
SELECT c1.Cnum , c1.Cname ,
       c2.Cnum , c2.Cname ,
       c1.Snum            --not solve
FROM Customerr c1
JOIN Customerr c2 ON c1.Snum = c2.Snum AND c1.Cnum < c2.Cnum;



Q252. Write a query that will give you all orders for more than $1000.00.

Answer:
select * from orders
where amt > 1000;



Q253. Write a query that lists each order number followed by the name of the customer who made that order.

Answer:
select onum,cname
from customerr r
left join orders o
on r.cnum=o.cnum;



Q254. Write 2 queries that select all salespeople (by name and number) who have customers in their cities who they

Answer:
select s.snum,s.sname
from salespeople s
join customerr c
on s.city = c.city and s.snum != c.snum;



Q255. Write a query that selects all customers whose ratings are equal than ANY (in the SQL sense) of Serres.

Answer:
select cname,cnum from customerr
where rating  in (select rating from customerr
                where snum = (select snum from salespeople
                              where sname = 'Serres'));

SELECT c.Cnum, c.Cname, c.Rating
FROM Customerr c
WHERE c.Rating >= ANY (
    SELECT c2.Rating        -----another way
    FROM Customerr c2
    JOIN Salespeople s ON c2.Snum = s.Snum
    WHERE s.Sname = 'Serres'
);



Q256. Write 2 queries that will produce all orders taken on October3 or October 4.

Answer:
select * from orders
where odate >= TO_DATE('03-OCT-96', 'DD-MON-YY') and odate < TO_DATE('05-OCT-96', 'DD-MON-YY') ;



Q257. Write a query that produces all pairs of orders by a given customer.

Answer:
select distinct c.cname,o.onum
from customerr c
join orders o
on c.cnum = o.cnum;



Q258. Find only those customers whose ratings are higher than every customer in Rome.

Answer:
select cname, rating from customerr
where rating > any (select rating from customerr
                where city = 'Rome');



Q259. Write a query on the customers table whose output will exclude all customers with a

Answer:
select cname, rating
from customerr
where (rating > 100 or city = 'Rome');



Q260. Find all rows from the Customer table for which the salesperson number is 1001.

Answer:
select * from customerr
where snum = 1001;



Q261. Find the total amount in Orders for each salesperson for which this total is greater than

Answer:
select snum,sum(amt) from orders
group by snum
having sum(amt) > max(amt);

select snum,sum(amt) from orders
group by snum
having sum(amt) > (select  max(amt) from orders ) ;



Q262. Write a query that selects all orders that have Zeroes or NULL in the Amount field.

Answer:
select * from orders
where amt = 0 or amt is null;

-- Produce all combinations of salespeople and customer names such that the former
-- precedes the latter alphabetically, and the latter has a rating of less than 200.

select sname, cname, rating
from salespeople s
cross join customerr r
where rating < 200
order by sname asc;
-- not solve
SELECT s.sname, c.cname
FROM salespeople s
CROSS JOIN customerr c
WHERE s.sname < c.cname
  AND c.rating < 200;



Q263. List all salespeople’s names and the commission they have earned.

Answer:
select sname, comm from salespeople;

select s.sname, sum(o.amt * s.comm)
from salespeople s         --for total comm
join orders o on s.snum = o.snum
group by s.sname;



Q264. with the same rating as Hoffman. Write the query using Hoffman’s

Answer:
select cname, city from customerr
where rating = (select rating from customerr
                where cname = 'Hoffman');

select cname, city from customerr
where rating = (select rating from customerr
                where cnum = 2001);



Q265. Find all salespeople for whom there are customers that follow them in alphabetical order.

Answer:
select  s.snum, s.sname
from salespeople s       --not solve logic not build
join customerr c on s.snum = c.snum
where s.sname < c.cname;



Q266. Write a query that produces the names and ratings of all customers of all who have above average orders.

Answer:
select cname,rating
from customerr r
join orders s
on r.cnum = s.cnum
where amt > (select avg(amt) from orders);



Q267. Find the sum of all purchases from the Orders table.

Answer:
select sum(amt) from orders;



Q268. Write a select command that produces the order number, amount, and date for all rows in the Order table.

Answer:
select onum,amt,odate from orders;



Q269. Count the number of not null rating fields in the Customer table including duplicates.

Answer:
select count(rating) from customerr;



Q270. Write a query that gives the names of both the salesperson and the

Answer:
select cname,sname,onum
from orders o
join salespeople s
on o.snum=s.snum
join customerr r
on o.cnum=r.cnum;



Q271. List the commissions of all salespeople servicing customers in London.

Answer:
select comm,sname
from salespeople s
join customerr c
on s.snum = c.snum
where c.city = 'London';



Q272. Write a query that selects all customers serviced by Peel or Motika.

Answer:
select cname from customerr
where snum in (select snum from salespeople
               where sname in ('Peel','Motika'));



Q273. (If a salesperson has more than one order on a given day, he or she should be counted only once.).

Answer:
select count(distinct snum),odate
from orders
group by odate;



Q274. Find all orders attributed to salespeople in London.

Answer:
select onum from orders
where snum in (select snum from salespeople
               where city = 'London' );



Q275. Find all orders by customers not located in the same cities as their salespeople.

Answer:
select onum
from orders o
join customerr c
on o.cnum = c.cnum
join salespeople s
on c.snum = s.snum
where c.city != s.city;



Q276. Find all salespeople who have customers with more than one current order.

Answer:
select s.snum,s.sname
from customerr r
join salespeople s
on s.snum = r.snum        ----logic not build like this
join orders o
on r.cnum = o.cnum
group by s.snum,s.sname
having count(o.onum) > 1 ;



Q277. Write a query that selects all customers whose name begins with ‘C’.

Answer:
select cname from customerr
where cname like 'C%';



Q278. Write a query on the Customers table that will find the highest rating in each city.

Answer:
select max(rating) as rating,city
from customerr
group by city;



Q279. Write a query that will produce the Snum values of all salespeople

Answer:
select distinct s.snum
from salespeople s
join orders o
on s.snum = o.snum;

select distinct snum
from orders;



Q280. Write a query that lists customers in descending order of rating.

Answer:
select rating, cname,cnum
from customerr
order by rating desc;



Q281. Find the average commission for salespeople in London.

Answer:
select avg(comm),city
from salespeople
group by city
having city = 'London';



Q282. Find all orders credited to the same salesperson that services Hoffman.

Answer:
select onum
from orders o
join salespeople s
on o.snum = s.snum
join customerr r
on s.snum = r.snum
where r.cname = 'Hoffman';



Q283. Find all salespeople whose commission is in between 0.10 and 0.12 both inclusive.

Answer:
select sname,comm from salespeople
where comm between 0.10 and 0.12;



Q284. Write a query that will give you the names and cities of

Answer:
select sname,city from salespeople
where city = 'London' and comm > 0.10;

-- What will be the output from the following query?



Q285. SELECT * FROM ORDERS WHERE (AMT < 1000 OR NOT (ODATE = 10/03/1996 AND CNUM > 2003));

Answer:
SELECT * FROM ORDERS WHERE (AMT < 1000 OR NOT (ODATE = TO_DATE( '10/03/1996','MM-DD-YYYY') AND CNUM > 2003));



Q286. Write a query that selects each customer’s smallest order.

Answer:
select min(amt) as "smallest order" , cnum
from orders
group by cnum;



Q287. Write a query that selects the first customer in alphabetical order whose name begins with ‘G’.

Answer:
select cname from customerr
where cname like 'G%' and  ROWNUM = 1 ;



Q288. Write a query that counts the number of different not NULL city values in the Customers table.

Answer:
select count(distinct city) from customerr;



Q289. Find the average amount from the Orders table.

Answer:
select avg(amt) from orders;

-- What would be the output from the following query?



Q290. SELECT*FROM ORDERS WHERE NOT (Odate =10/03/1996 OR Snum>1006) AND amt. >=1500);

Answer:
SELECT*FROM ORDERS WHERE not  (Odate =TO_DATE('10/03/1996','MM-DD-YYYY') OR Snum>1006) AND amt >=1500;



Q291. Find all customers who are not located in San Jose & whose rating is above 200.

Answer:
select cname,city,rating from customerr
where city not in 'San Jose'
and rating > 200 ;



Q292. SELECT Snum, Sname, city, Comm FROM salespeople WHERE (Comm>0.12 and Comm <0.14);

Answer:
select * from salespeople
where comm between  0.13 and 0.13;

-- Evaluate the following query:
SELECT * FROM orders WHERE NOT ((Odate = 10/03/1996 AND Snum>1002) OR amt>2000);

-- Which salespeople attend to customers not in the city they have been assigned to?

select s.snum, s.sname, s.city as "salespeople city" , c.cname, c.city as "customer city"
from Salespeople s
join customerr c on s.snum = c.snum
where s.city != c.city;



Q293. Which salespeople get commission greater than 0.11 and serving customers rated less than 250?

Answer:
select s.sname,s.comm,c.cname,c.rating
from salespeople s
join customerr c
on s.snum = c.snum
where s.comm > 0.11
and c.rating < 250;



Q294. Which salespeople have been assigned to the same city but get different commission percentages?

Answer:
select sname
from salespeople s1    --not solve
join salespeople s2
on s1.city = s2.city
where s1.Snum < s2.Snum AND s1.Comm != s2.Comm;

-- Which salesperson has earned the most by way of commission?

select sname,max(comm) from salespeople
group by sname   --not solve
where rownum <= 1 ;

-- Does the customer who has placed the maximum number of orders have the maximum rating?

-- Has the customer who has spent the largest amount of money been given the highest rating?



Q295. List all customers in descending order of customer rating.

Answer:
select cname , rating
from customerr
order by rating desc;

-- On which days has Hoffman placed orders?

select odate from orders
where cnum = (select cnum from customerr
              where cname = 'Hoffman' );

-- Do all salespeople have different commissions?

select count(*) as "Total salespeople", count(distinct comm) as "total comm"
from salespeople;

-- Which salespeople have no orders between 10/03/1996 and 10/05/1996?

select s.snum,s.sname
from Salespeople s
where s.snum not in (select snum from orders
                     where odate between to_date('10/03/1996','MM-DD-YYYY')
                     and to_date('10/05/1996','MM-DD-YYYY'));



Q296. How many salespersons have succeeded in getting orders?

Answer:
select snum,count(onum) from orders
group by snum;



Q297. How many customers have placed orders?

Answer:
select count(distinct cnum) from orders ;

-- On which date has each salesperson booked an order of maximum value?

select distinct snum,max(amt),odate
from orders      --not solve
group by snum, odate;

-- Who is the most successful salesperson?

select sum(amt),snum
from orders
group by snum   --not clear ans
order by max(amt) desc
having rounum = 1;
fetch first 1 row only ;


-- Who is the worst customer with respect to the company?

select c.cname,c.cnum,sum(amt)
from customerr c
join orders o
on c.cnum = o.cnum
group by c.cname,c.cnum
order by sum(amt) asc
rownum = 1;


-- Are all customers not having placed orders greater than 200 totally
-- been serviced by salesperson Peel or Serres?


-- Which customers have the same rating?

select c1.cname,c1.rating from customerr c1
join customerr c2 ------not clear
on c1.rating = c2.rating and c1.cnum != c2.cnum;
where c1.rating = c2.rating;



Q298. Find all orders greater than the average for October 4th.

Answer:
select amt,onum
from orders where amt > (select avg(amt) from orders
                         where odate = TO_DATE('04-10','DD-MM'));

-- Which customers have above average orders?

select cnum from orders
where amt > (select avg(amt) from orders);



Q299. List all customers with ratings above San Jose’s average.

Answer:
select cname,rating from customerr
where rating > (select avg(rating) from customerr
                group by city
                having  city = ('San Jose'));



Q300. Select the total amount in orders for each salesperson for which

Answer:
select sum(amt),snum from orders
group by snum
having sum(amt) > (select max(amt) from orders);

-- Give names and numbers of all salesperson that have more than one customer.

select s.sname,s.snum
from salespeople s
join customerr r
on s.snum = r.snum
group by s.sname,s.snum
having count(r.cnum) > 1;



Q301. Select all salesperson by name and numbers who have customers in their city whom they don’s the service.

Answer:
select s.sname,s.snum
from salespeople s
join customerr r
on s.city = r.city-------not done logic not build
where s.snum != r.snum;

-- Which customers’ rating should be lowered?

select cname from customerr
group by cname -----------not solve
having rating = min(rating);

-- Is there a case for assigning a salesperson to Berlin?



-- Is there any evidence linking the performance of a salesperson to commission that he or she is being paid?



-- Dose the total amount in orders by customer in Rome and London exceeds
-- the commission paid to salesperson in London and New York by more than 5 times?


-- Which is the date, order number, amt and city for each salesperson (byname) for
-- the maximum order he has obtained?


-- Which salesperson(s) should be fired?

select sname from salespeople
where snum <> any (select snum from orders);

select sname
from salespeople s
join orders o on s.snum = o.snum;
-- What is the total income for the company?

select sum(amt) as total_income
from orders;



Q302. Write a query to find the 2nd highest salary from an employee table.

Answer:
select max(salary) from hr.employees where salary < (
select max(salary) from hr.employees ) ; ---using subquery

select salary
  from (select distinct salary,
                        dense_rank() over(order by salary desc) as rn
          from hr.employees)       --using dense_rank
 where rn = 2;

select distinct salary
  from (select salary from hr.employees order by salary desc)
 where rownum <= 2;   ---using rownum

SELECT MIN(salary) AS second_highest
  FROM (SELECT DISTINCT salary FROM hr.employees ORDER BY salary DESC)
 WHERE ROWNUM <= 2;   ---using rownum


select * from hr.employees ;



Q303. Write a SQL query to find employees who have the same manager.

Answer:
SELECT manager_id, COUNT(*) AS emp_count
FROM hr.employees
WHERE manager_id IS NOT NULL
GROUP BY manager_id
HAVING COUNT(*) > 1;
-- 
SELECT e1.employee_id AS emp1_id,
       e1.first_name AS emp1_name,
       e2.employee_id AS emp2_id,
       e2.first_name AS emp2_name,
       e1.manager_id
FROM hr.employees e1
JOIN hr.employees e2
  ON e1.manager_id = e2.manager_id
 AND e1.employee_id < e2.employee_id
WHERE e1.manager_id IS NOT NULL;
-- 
SELECT employee_id, first_name, manager_id,
       COUNT(*) OVER (PARTITION BY manager_id) AS team_size
FROM hr.employees
WHERE manager_id IS NOT NULL;
-- 
SELECT DISTINCT a.first_name, a.manager_id
FROM hr.employees a
JOIN hr.employees b
  ON a.manager_id = b.manager_id
 AND a.employee_id != b.employee_id
WHERE a.manager_id IS NOT NULL;

select * from hr.employees ;



Q304. Write a query to find the first and last record for each employee based on the 'hire_date' column.

Answer:
SELECT *
FROM hr.employees
WHERE hire_date = (SELECT MIN(hire_date) FROM hr.employees);

-- Last hire (latest in the company)
SELECT *
FROM hr.employees
WHERE hire_date = (SELECT MAX(hire_date) FROM hr.employees);

select * from hr.employees ;



Q305. Write a query to find the most recent transaction for each customer.

Answer:
SELECT *
FROM (
  SELECT
    customer_id,
    transaction_id,
    transaction_date,
    amount,
    ROW_NUMBER() OVER (PARTITION BY customer_id ORDER BY transaction_date DESC) AS rn
  FROM transactions
)
WHERE rn = 1;
-- 
select *
  from (select employee_id,
               first_name,
               last_name,
               salary,
               hire_date,
               row_number() over(partition by employee_id order by hire_date desc) as rn
          from hr.employees)
 where rn <= 1;

select * from transactions ;



Q306. Write a query to find the total salary of each department and display departments

Answer:
select department_id, sum(salary) as total_salary from hr.employees
group by department_id having sum(salary) > 50000 ;



Q307. Write a query to find the running total of orders for each customer sorted by order date.

Answer:
SELECT
  customer_id,
  order_id,
  order_date,
  order_amount,
  SUM(order_amount) OVER (
    PARTITION BY customer_id
    ORDER BY order_date
  ) AS running_total
FROM orders
ORDER BY customer_id, order_date;



Q308. Write a query to get the total number of employees hired per month and year.

Answer:
SELECT
  TO_CHAR(hire_date, 'YYYY') AS hire_year,
  TO_CHAR(hire_date, 'MM') AS hire_month,
  COUNT(*) AS total_hired
FROM
  hr.employees
GROUP BY
  TO_CHAR(hire_date, 'YYYY'),
  TO_CHAR(hire_date, 'MM')
ORDER BY
  hire_year,
  hire_month;



Q309. Write a query to display all employees who earn more than the average salary for their department.

Answer:
SELECT employee_id, first_name, last_name, department_id, salary
FROM hr.employees e
WHERE salary > (
    SELECT AVG(salary)
    FROM hr.employees
    WHERE department_id = e.department_id
);



Q310. Write a query to get the second

Answer:
SELECT MAX(salary) AS second_lowest_salary
FROM (
  SELECT DISTINCT salary
  FROM hr.employees
  ORDER BY salary ASC
)
WHERE ROWNUM <= 2;



Q311. Write a query to list all products that have never been ordered (assuming an 'orders' table

Answer:
SELECT p.product_id, p.product_name
FROM products p
LEFT JOIN orders o ON p.product_id = o.product_id
WHERE o.product_id IS NULL;

-- Method 2: Using NOT EXISTS
SELECT p.product_id, p.product_name
FROM products p
WHERE NOT EXISTS (
  SELECT 1
  FROM orders o
  WHERE o.product_id = p.product_id
);

-- Method 3: Using NOT IN (Use with caution if NULLs are present in orders.product_id)
SELECT p.product_id, p.product_name
FROM products p
WHERE p.product_id NOT IN (
  SELECT product_id FROM orders
);



Q312. Write a query to list all the employees who are also managers.

Answer:
SELECT DISTINCT e.employee_id, e.first_name, e.last_name
FROM hr.employees e
JOIN hr.employees m ON e.employee_id = m.manager_id;

SELECT DISTINCT e.employee_id, e.first_name, e.last_name
FROM hr.employees e
WHERE e.employee_id IN (
  SELECT DISTINCT manager_id
  FROM hr.employees
  WHERE manager_id IS NOT NULL
);

select * from hr.employees ;



Q313. Write a query to find employees who have joined in the same month and year.

Answer:
SELECT DISTINCT A.employee_id, A.first_name, A.hire_date,
       B.employee_id AS colleague_id, B.first_name AS colleague_name, B.hire_date AS colleague_hire_date
FROM hr.employees A
JOIN hr.employees B
  ON A.employee_id <> B.employee_id
 AND EXTRACT(MONTH FROM A.hire_date) = EXTRACT(MONTH FROM B.hire_date)
 AND EXTRACT(YEAR FROM A.hire_date) = EXTRACT(YEAR FROM B.hire_date)
ORDER BY A.hire_date;

SELECT employee_id, first_name, hire_date
FROM (
  SELECT employee_id, first_name, hire_date,
         COUNT(*) OVER (PARTITION BY TO_CHAR(hire_date, 'YYYY-MM')) AS cnt
  FROM hr.employees
)
WHERE cnt > 1
ORDER BY hire_date;



Q314. Write a SQL query to get a list of employees who are older than the average age of

Answer:
select first_name
  from hr.employees
 where hire_date <
       (SELECT TO_DATE(AVG(hire_date - TO_DATE('01-JAN-1900', 'DD-MON-YYYY')) +
                       TO_DATE('01-JAN-1900', 'DD-MON-YYYY')) AS avg_hire_date
          FROM hr.employees);

-- 
SELECT e.employee_id,
       e.first_name,
       e.last_name,
       e.department_id,
       ROUND(MONTHS_BETWEEN(SYSDATE, e.hire_date)/12, 2) AS tenure_in_years
FROM hr.employees e
WHERE ROUND(MONTHS_BETWEEN(SYSDATE, e.hire_date)/12, 2) >
      (
        SELECT ROUND(AVG(MONTHS_BETWEEN(SYSDATE, e2.hire_date)/12), 2)
        FROM hr.employees e2
        WHERE e2.department_id = e.department_id
      );



Q315. Write a query to display the employee(s) with the longest tenure at the company.

Answer:
SELECT employee_id,
       first_name,
       last_name,
       hire_date
FROM hr.employees
WHERE hire_date = (SELECT MIN(hire_date) FROM hr.employees);



Q316. Write a query to delete all records from a table where the column value is NULL.

Answer:
DELETE FROM table_name
WHERE column_name IS NULL;



Q317. Write a query to find all pairs of products that were ordered together at least once.

Answer:
SELECT DISTINCT
       oi1.product_id AS product_1,
       oi2.product_id AS product_2
FROM order_items oi1
JOIN order_items oi2
  ON oi1.order_id = oi2.order_id
 AND oi1.product_id < oi2.product_id;



Q318. Write a query to find the average order value by customer for each month.

Answer:
SELECT
  customer_id,
  TO_CHAR(order_date, 'YYYY-MM') AS order_month,
  ROUND(AVG(order_total), 2) AS avg_order_value
FROM orders
GROUP BY
  customer_id,
  TO_CHAR(order_date, 'YYYY-MM')
ORDER BY
  customer_id,
  order_month;



Q319. Write a query to identify customers who made a purchase every month for the past year.

Answer:
SELECT customer_id
FROM (
  SELECT customer_id,
         TO_CHAR(order_date, 'YYYY-MM') AS order_month
  FROM orders
  WHERE order_date >= ADD_MONTHS(TRUNC(SYSDATE, 'MM'), -11)  -- past 12 months
)
GROUP BY customer_id
HAVING COUNT(DISTINCT order_month) = 12;



Q320. Write a query to find the total revenue for each region in a given quarter.

Answer:
SELECT region,
       SUM(order_total) AS total_revenue
FROM orders
WHERE TO_CHAR(order_date, 'Q') = '2'  -- Example: Q2
  AND TO_CHAR(order_date, 'YYYY') = '2024'
GROUP BY region;



Q321. Write a query to find the first purchase date of each customer.

Answer:
SELECT customer_id,
       MIN(order_date) AS first_purchase_date
FROM orders
GROUP BY customer_id;



Q322. Write a query to calculate the year

Answer:
SELECT EXTRACT(YEAR FROM order_date) AS year,
       SUM(order_total) AS revenue,
       LAG(SUM(order_total)) OVER (ORDER BY EXTRACT(YEAR FROM order_date)) AS previous_year_revenue,
       ROUND(
         (SUM(order_total) - LAG(SUM(order_total)) OVER (ORDER BY EXTRACT(YEAR FROM order_date)))
         / LAG(SUM(order_total)) OVER (ORDER BY EXTRACT(YEAR FROM order_date)) * 100, 2
       ) AS yoy_growth_percent
FROM orders
GROUP BY EXTRACT(YEAR FROM order_date)
ORDER BY year;



Q323. Write a query to find the 'Nth' highest salary from the employee table

Answer:
SELECT *
FROM (
  SELECT salary,
         DENSE_RANK() OVER (ORDER BY salary DESC) AS salary_rank
  FROM employees
)
WHERE salary_rank = :N;  -- Replace :N with desired rank (e.g., 3 for 3rd highest)



Q324. Get all employee details from the employee table

Answer:
select * from employee;



Q325. Get First_Name,Last_Name from employee table

Answer:
select first_name, last_name from employee;



Q326. Get First_Name from employee table using alias name “Employee Name”

Answer:
select first_name as "Employee Name" from employee;



Q327. Get First_Name from employee table in upper case

Answer:
select upper(first_name) from employee;



Q328. Select first 3 characters of FIRST_NAME from EMPLOYEE

Answer:
select substr(first_name, 1,3) from employee;



Q329. Get position of 'o' in name 'John' from employee table

Answer:
select instr(first_name, 'o')as position from employee
where first_name = 'John' ;



Q330. Get FIRST_NAME from employee table after removing white spaces from right side.

Answer:
select rtrim(first_name) from employee;



Q331. Get First_Name from employee table after replacing 'o' with '$'

Answer:
select translate(first_name, 'o', '$') from employee;



Q332. Get First_Name and Last_Name as single column from employee table separated by a '_'

Answer:
select first_name || '_' || last_name as "combine name"
from employee;



Q333. Get FIRST_NAME, Joiningyear, Joining Month and Joining Date from employee table

Answer:
select first_name, joining_date from employee;

select first_name,
       to_char(joining_date, 'YYYY') as "joining year",
       to_char(joining_date, 'MM') as "joining month", ---not solve like this
       to_char(joining_date, 'DD') as "joining date"
from employee;



Q334. Get all employee details from the employee table order by First_Name Ascending

Answer:
select * from employee
order by first_name asc;



Q335. Get all employee details from the employee table order by First_Name Ascending and Salary Descending?

Answer:
select * from employee
order by salary desc, first_name asc;

select * from (
select * from employee
order by first_name asc)
order by salary desc;



Q336. Get employee details from employee table whose employee name is “John”

Answer:
select * from employee
where first_name = 'John';



Q337. Get employee details from employee table whose employee name are “John” and “Roy”

Answer:
select * from employee
where first_name in ('John', 'Roy');



Q338. Get employee details from employee table whose employee name are not “John” and “Roy”.

Answer:
select * from employee
where first_name not in ('John', 'Roy');



Q339. Get employee details from employee table whose first name starts with 'J'.

Answer:
select * from employee
where first_name like 'J%';



Q340. Get employee details from employee table whose first name contains 'o'.

Answer:
select * from employee
where first_name like '%o%';



Q341. Get employee details from employee table whose first name ends with 'n'.

Answer:
select * from employee
where first_name like '%n';



Q342. Get employee details from employee table whose first name ends with 'n' and name contains 4 letters.

Answer:
select * from employee
where first_name like '___n';



Q343. Get employee details from employee table whose first name starts with 'J' and name contains 4 letters.

Answer:
select * from employee
where first_name like 'J___';



Q344. Get employee details from employee table who’s Salary greater than 600000.

Answer:
select * from employee
where salary > 600000;



Q345. Get employee details from employee table whose joining year is “2013”.

Answer:
select * from employee                      -- NOT Clear This Q --
where joining_date = TO_CHAR('2013', 'YYYY') ;

SELECT *
FROM employee
WHERE EXTRACT(YEAR FROM joining_date) = 2013;

SELECT *
FROM employee
WHERE TO_CHAR(joining_date, 'YYYY') = '2013';



Q346. Get employee details from employee table whose joining month is “January”.

Answer:
select * from employee
where to_char(joining_date, 'MM') = '01' ;



Q347. Get employee details from employee table who joined before January 1st 2013.

Answer:
select * from employee
where to_char(joining_date, 'DD-MM-YYYY') <= '01-01-2013' ;

select * from employee
where joining_date < to_date('01-JAN-2013', 'DD-MON-YYYY');



Q348. Get employee details from employee table who joined after January 31st

Answer:
select * from employee
where joining_date > to_date('31-JAN-2013', 'DD-MON-YYYY');



Q349. Get Joining Date and Time from employee table

Answer:
SELECT TO_CHAR(joining_date, 'DD-MON-YYYY HH24:MI:SS') AS joining_date_time
FROM employee;    -- This Q not Solve



Q350. Get Joining Date, Time including milliseconds from employee table

Answer:
SELECT TO_CHAR(joining_date, 'DD-MON-YYYY HH24:MI:SS:MSS') AS joining_date_time
FROM employee; -- Thi Q not sove

SELECT TO_CHAR(joining_date, 'DD-MON-YYYY HH24:MI:SS.FF3') AS joining_date_time
FROM employee;   --



Q351. Get difference between JOINING_DATE and INCENTIVE_DATE from employee and incentives table.

Answer:
select e.emp_id,e.first_name, e.joining_date, i.incentive_date, i.incentive_date - e.joining_date AS days_difference
from employee e inner join  incentives i  --almost done but dont know to get difference from 2 table date column
on e.emp_id = i.employee_ref_id;          --for getting difference then use like this '_'



Q352. Get department, total salary with respect to a department from employee table.

Answer:
select department, sum(salary) as "total salary" from employee
group by department;



Q353. Get department, total salary with respect to a department from employee table order by total salary descending.

Answer:
select department, sum(salary) as "total salary" from employee
group by department
order by sum(salary) desc;

select * from(
select department, sum(salary) as "total salary" from employee
group by department)
order by "total salary" desc;



Q354. Get department, no of employees in a department, total salary with respect to a

Answer:
select department, count(emp_id), sum(salary)
from employee
group by department
order by sum(salary) desc;



Q355. Get department wise average salary from employee table order by salary ascending?

Answer:
select department, avg(salary) as "average salary" from employee
group by department
order by avg(salary) asc;



Q356. Get department wise maximum salary from employee table order by salary ascending?

Answer:
select department, max(salary) as "maximum salary" from employee
group by department
order by max(salary) asc;



Q357. Get department wise minimum salary from employee table order by salary ascending?

Answer:
select department, min(salary) as "minimum salary" from employee
group by department
order by min(salary) asc;



Q358. Select no of employees joined with respect to year and month from employee table.

Answer:
select joining_date, count(emp_id) from employee
group by joining_date;       -- not clear this Q

SELECT
    TO_CHAR(joining_date, 'YYYY') AS joining_year,
    TO_CHAR(joining_date, 'Month') AS joining_month,
    COUNT(emp_id) AS no_of_employees
FROM
    employee           -- This is right Query
GROUP BY
    TO_CHAR(joining_date, 'YYYY'),
    TO_CHAR(joining_date, 'Month')
ORDER BY
    joining_year,
    joining_month;



Q359. Select department,total salary with respect to a department from employee table

Answer:
select department, sum(salary) as "total salary"
from employee
group by department
having sum(salary) > 800000
order by "total salary" desc;



Q360. Select employee details from employee table if data in incentive table?

Answer:
select distinct e.*
from employee e
join incentives i
on e.emp_id = i.employee_ref_id;



Q361. Select 20 % of salary from John, 10% of Salary for Roy and for other 15 % of salary from employee table

Answer:
select first_name, salary,
       case
         when first_name = 'John' then salary * 0.20
         when first_name = 'Roy' then salary * 0.10
         else salary * 0.15
       end as "percent salary"
from employee;



Q362. Select Banking as 'Bank Dept', Insurance as 'Insurance Dept' and Services as 'Services Dept' from employee table.

Answer:
select department,
       case
         when department = 'Banking' then 'Bank Dept'
         when department = 'Insurance' then 'Insurance Dept'
         when department = 'Services' then 'Services Dept'
         else department
       end
from employee;

-- Delete employee data from employee table who got incentives in incentive table

delete from employee
where emp_id in (select employee_ref_id
                 from incentives);

rollback;



Q363. Select first_name, incentive amount from employee and incentives table for those employees who have incentives.

Answer:
select first_name,incentive_amount
from employee e
join  incentives i
on e.emp_id=i.employee_ref_id;



Q364. Select first_name, incentive amount from employee and incentives table for those

Answer:
select first_name,incentive_amount
from employee e
join  incentives i
on e.emp_id=i.employee_ref_id
where incentive_amount > 3000;



Q365. all employees even if they didn't get incentives

Answer:
select e.first_name,i.incentive_amount
from employee e
left join  incentives i
on e.emp_id=i.employee_ref_id;



Q366. if they didn't get incentives and set incentive amount as 0 for those employees who didn't get incentives.

Answer:
select e.first_name,nvl(incentive_amount, 0) "incentive amount"
from employee e
left join  incentives i
on e.emp_id=i.employee_ref_id;

select e.first_name,max(nvl(incentive_amount, 0)) "incentive amount"
from employee e
left join  incentives i
on e.emp_id=i.employee_ref_id
group by e.first_name;



Q367. Select first_name, incentive amount from employee and incentives table for

Answer:
select e.first_name,i.incentive_amount
from employee e
left join  incentives i
on e.emp_id=i.employee_ref_id
where i.incentive_amount is not null;



Q368. Select max incentive with respect to employee from employee and incentives table using sub query.

Answer:
select first_name, (
select max(incentive_amount) from incentives
where emp_id=employee_ref_id)      ---Not Clear This Q
from employee ;



Q369. Find the largest order taken by each salesperson on each date.

Answer:
select snum,max(amt),odate
from orders
group by snum,odate;

-- Arrange the Orders table by descending customer number.

select * from orders
order by cnum;



Q370. Select all salesperson by name and numbers who have customers in their city whom they don’s the service.

Answer:
select s.sname,s.snum
from salespeople s
join customerr r
on s.city = r.city-------not done logic not build
where s.snum != r.snum;

-- Which customers’ rating should be lowered?

select cname from customerr
group by cname -----------not solve
having rating = min(rating);



Q371. Q.1 List all the customers serviced.

Answer:
select distinct cid from ser_det;



Q372. Q.2 Customers who are not serviced.

Answer:
select cid from customer1
where cid not in  (select cid from ser_det);



Q373. Q.3 Employees who have not received the commission.

Answer:
select distinct ename
from employe e
join ser_det s
on e.eid = s.eid
where comm <= 0;



Q374. Q.4 Name the employee who have maximum Commission.

Answer:
select distinct ename
from employe e
join ser_det s
on e.eid = s.eid
where comm = (select max(comm) from ser_det);



Q375. Q.5 Show employee name and minimum commission amount received by an employee.

Answer:
select distinct ename,min(comm)
from employe e
join ser_det s
on e.eid = s.eid
group by ename;



Q376. Q.6 Display the Middle record from any table.

Answer:
select cadd,c_contact,c_creditdays from customer1;



Q377. Q.7 Display last 4 records of any table.

Answer:
select * from (
select * from employe
order by eid desc)
where rownum <= 4;



Q378. Q.10 Show the name of Customer who have paid maximum amount

Answer:
select cname from customer1 c join ser_det s
on c.cid = s.cid
where comm = (select max(comm) from ser_det);



Q379. Q.11 Display Employees who are not currently working.

Answer:
select ename from employe
where edol is null;



Q380. Q.12 How many customers serviced their two wheelers.

Answer:
select count(distinct cid),typ_veh
from ser_det
group by typ_veh
having typ_veh = 'TWO WHEELER';



Q381. Q.13 List the Purchased Items which are used for Customer Service with Unit of that Item.

Answer:
select spname,s.spid,pqty
from sparepart s
inner join purchase p
on s.spid = p.spid;



Q382. Q.14 Customers who have Colored their vehicles.

Answer:
select cname
from customer1 c
inner join ser_det s
on c.cid = s.cid
where typ_ser = 'COLOR';



Q383. Q.15 Find the annual income of each employee inclusive of Commission

Answer:
select ename, (e.esal * 12) + (s.comm) as "Total Salary"
from employe e
inner join ser_det s
on e.eid = s.eid;



Q384. Q.16 Vendor Names who provides the engine oil.

Answer:
select v.vid,v.vname
from vendors v
join purchase p on v.vid = p.vid
join sparepart s on p.spid = s.spid
where spname like '%ENGINE OIL%';



Q385. Q.17 Total Cost to purchase the Color and name the color purchased.

Answer:
select s.spname,total
from purchase p
join sparepart s on p.spid = s.spid
where s.spname like '%COLOR%';



Q386. Q.19 Spare Parts Not Purchased but existing in Sparepart

Answer:
select spname
from sparepart s
left join purchase p on s.spid = p.spid
where p.spid is null;



Q387. Q.20 Calculate the Profit/Loss of the Firm. consider one month salary of each employee for Calculation.

Answer:
select  e.ename,sum(e.esal) - sum(s.total) as "profit and loss"
from employe e
join ser_det s on e.eid = s.eid;
group by e.ename;



Q388. Q.21 Specify the names of customers who have serviced their vehicles more than one time.

Answer:
select cname
from customer1 c
join ser_det s on c.cid = s.cid
group by cname
having count(veh_no) > 1 ;



Q389. Q.22 List the Items purchased from vendors locationwise.

Answer:
select vname,vadd,spname
from vendors v
join purchase p on v.vid = p.vid
join sparepart s on p.spid = s.spid;



Q390. Q.23 Display count of two wheeler and four wheeler from ser_details

Answer:
select typ_veh,count(typ_veh)
from ser_det
group by typ_veh;



Q391. Display name of customers who paid highest SPGST and for which item

Answer:
select cname
from customer1 c
join ser_det s on c.cid = s.cid
where sp_g = (select max(sp_g) from ser_det);



Q392. Display vendors name who have charged highest SPGST rate for which item

Answer:
select vname
from vendors v
join purchase p on v.vid=p.vid
where spgst = (select max(spgst) from purchase);



Q393. list name of item and employee name who have received item

Answer:
select ename,spname
from sparepart s
join purchase p on s.spid = p.spid
join employe e on p.rcv_eid = e.eid;



Q394. Display the Name and Vehicle Number of Customer who serviced his vehicle,

Answer:
select cname,veh_no,typ_ser,p.pdate,vname,vadd,ename,spname
from ser_det s
join customer1 c on c.cid = s.cid
join sparepart sp on s.spid = sp.spid
join purchase p on p.spid = sp.spid
join vendors v on p.vid = v.vid
join employe e on e.eid = s.eid
where veh_no = 'MH-14PA335';



Q395. who belong this vehicle MH

Answer:
select cname
from customer1 c
join ser_det s on c.cid = s.cid
where veh_no = 'MH-14PA335' ;



Q396. Display the name of customer who belongs to New York and when

Answer:
select cname
from customer1 c
join ser_det s on c.cid = s.cid
where cadd = 'NEW YORK';



Q397. Q 30 from whom we have purchased items having maximum cost?

Answer:
select p.vid,total,vname
from purchase p
join vendors v on p.vid = v.vid
where total = (select max(total) from purchase);



Q398. Display the names of employees who are not working as Mechanic and that employee done services .

Answer:
select distinct ename
from employe e
join ser_det s on e.eid = s.eid
where ejob not in 'MECHANIC';



Q399. Display the various jobs along with total number of employees in each job. The output should

Answer:
select ejob,count(ename) as "Total_Employee"
from employe
group by ejob
having count(ename) > 2;



Q400. Display the details of employees who done service and give them rank according to their no. of services .

Answer:
select e.ename,count(s.sid),
 rank() over (order by count(s.sid) desc) as "service rank"
from employe e
join ser_det s on e.eid = s.eid
group by e.ename;



Q401. who provide service and total count of service done by fitter and painter

Answer:
select ename,ejob,count(s.sid)
from employe e
join ser_det s on e.eid = s.eid
where ejob in ('PAINTER', 'FITTER')
group by ename,ejob;



Q402. Display employee salary and as per highest salary provide Grade to employee

Answer:
select ename,esal,
      case
          when esal >= 2000 then 'A'
          when esal >= 1500 then 'B'
          when esal >= 1000 then 'C'
          else 'D'
      end as grade
from employe;



Q403. Provide a commission 100 to employees who are not earning any commission.

Answer:
select eid,
     case
       when comm = 0 then 100
       else comm
     end as commission
from ser_det;



Q404. write a query that totals no. of services for each day and place the results

Answer:
select ser_date,count(sid)
from ser_det
group by ser_date
order by count(sid) desc;



Q405. Display the service details of those customer who belong from same city

Answer:
select c.cname, c.cadd,s.sid
from ser_det s
join customer1 c on c.cid = s.cid
join customer1 c2 on c.cadd = c2.cadd
where c.cid != c2.cid;



Q406. write a query join customers table to itself to find all pairs of

Answer:
select c1.cname as customerr1 , c2.cname as customerr2 ,s.sid
from ser_det s    ----not clear
join customer1 c1 on s.cid = c1.cid
join customer1 c2 on s.cid = c2.cid
where c1.cid <> c2.cid



Q407. List each service number follow by name of the customer who

Answer:
select typ_ser,cname
from customer1 c
join ser_det s on c.cid = s.cid ;



Q408. Write a query to get details of employee and provide rating on basis of

Answer:
select ename,count(sid),
        case
          when count(sid) > 5 then 'A'
          when count(sid) > 3 then 'B'
          when count(sid) > 2 then 'C'
          else 'D'
        end as rating
from employe e
join ser_det s on e.eid = s.eid
group by ename;



Q409. Write a query to get maximum service amount of each customer with their customer details ?

Answer:
select cname,max(total) as service_amount
from customer1 c
join ser_det s on c.cid = s.cid
group by cname;



Q410. Get the details of customers with his total no of services ?

Answer:
select cname,count(sid) as service_amount
from customer1 c
join ser_det s on c.cid = s.cid
group by cname;



Q411. From which location sparpart purchased with highest cost ?

Answer:
select * from(
select vadd,max(total)
from vendors v
join purchase p on v.vid = p.vid
group by vadd
order by max(total) desc )
where rownum = 1 ;



Q412. Get the details of employee with their service details who has salary is null

Answer:
select * from employe
where esal is null;



Q413. find the sum of purchase location wise

Answer:
select vadd,sum(total)
from vendors v
join purchase p on v.vid = p.vid
group by vadd;



Q414. write a query sum of purchase amount in word location wise ?

Answer:
select cadd,sum(p.total)
from customer1 c
join ser_det s on c.cid = s.cid
join purchase p on s.spid = p.spid
group by cadd;



Q415. select the total amount in service for each customer for which

Answer:
select cid,sum(total)
from ser_det
group by cid
having sum(total) > any (select max(total) from ser_det);



Q416. List the customer name and sparepart name used for their vehicle and vehicle type

Answer:
select cname,spname,typ_veh
from customer1 c
join ser_det s on c.cid = s.cid
join sparepart sp on sp.spid = s.spid;



Q417. Write a query to get spname ,ename,cname quantity ,rate ,service amount for record exist in service table

Answer:
select spname,ename,cname,qty,sp_rate,ser_amt
from sparepart sp
join ser_det s on sp.spid = s.spid
join employe e on e.eid = s.eid
join customer1 c on c.cid = s.cid;



Q418. specify the vehicles owners who’s tube damaged.

Answer:
select cname,typ_ser,typ_veh
from customer1 c
join ser_det s on c.cid = s.cid
where typ_ser = 'TUBE DAMAGED';



Q419. Q.54 Specify the details who have taken full service.

Answer:
select s.*,cname
from customer1 c
join ser_det s on c.cid = s.cid
where typ_ser = 'FULL SERVICING';



Q420. Q.55 Select the employees who have not worked yet and left the job.

Answer:
select ename
from employe e
join ser_det s on e.eid = s.eid
where edol is not null;



Q421. Q.56 Select employee who have worked first ever.

Answer:
select * from(
select ename,min(ser_date) from employe e
join ser_det s on e.eid = s.eid
group by ename
order by min(ser_date) asc)
where rownum = 1 ;



Q422. Q.57 Display all records falling in odd date

Answer:
select * from ser_det               -------not done
where ser_date like '_1%' or ser_date like '_3%';



Q423. Q.59 Display the vendors whose material is not yet used.

Answer:
select p.spid,vname
from vendors v
join purchase p on v.vid = p.vid
join ser_det s on p.spid = s.spid ---not done
where s.spid in null ;



Q424. Q.60 Difference between purchase date and used date of spare part.

Answer:
select p.pdate,s.ser_date, p.pdate - s.ser_date as difference
from ser_det s
join purchase p on s.spid = p.spid;



Q425. WAQ to display the employee who are working in the location 'CHICAGO' from emp & dept table by using Equi join?

Answer:
select ename,loc from emp e,dept d
where loc ='CHICAGO'
and d.deptno=e.deptno

-- Note:If you wont to filter data after joining condition then we are using AND operator.



Q426. WAQ to display the dname,sum(sal) from emp,dept table by using Equi join?

Answer:
select dname,sum(sal),count(*) from emp e,dept d
where e.deptno=d.deptno
group by dname;

select d.deptno,dname,sum(sal) from emp e,dept d
where e.deptno=d.deptno
group by d.deptno,dname;



Q427. WAQ to display loc,no.of employees,min sal,max sal from emp dept table by using equi join?

Answer:
select loc,count(empno),min(sal),max(sal)
from emp e,dept d
where d.deptno=e.deptno
group by loc;



Q428. WAQ to display ename and mgrname from emp table by using self join?

Answer:
select e.ename ,e2.ename
from emp e ,emp e2
where e.mgr = e2.empno;

select * from emp



Q429. WAQ to display the employees who are getting more salary than their manager salary from emp table

Answer:
select e1.ename "employees" ,e1.sal,e2.ename "manager",e2.sal
from emp e1,emp e2
where e1.mgr=e2.empno
and e1.sal>e2.sal;



Q430. WAQ to display the employees who are joining before their manager from emp

Answer:
select e1.ename "employee",e1.hiredate ,e2.ename "manager",e2.hiredate
from emp e1,emp e2
where e1.mgr=e2.empno
and e1.hiredate<e2.hiredate;



Q431. Write a SQL query for: select employee_id,salary,sum(salary) over (order by salary)as running_total from hr.employees ;

Answer:
select employee_id,salary,sum(salary) over (order by salary)as running_total from hr.employees ;



Q432. Q.2 find the third highest salary

Answer:
select max(salary)
  from hr.employees
 where salary <
       (select max(salary)
          from hr.employees
         where salary < (select max(salary) from hr.employees));

select salary
  from (select salary, dense_rank() over(order by salary desc) as rn
          from hr.employees)
 where rn = 3;

select min(salary) from (
select distinct salary from hr.employees order by salary desc
) where rownum <= 3 ;



Q433. Query to find Second Highest Salary of Employee?

Answer:
select max(salary)
  from hr.employees
 where salary < (select max(salary) from hr.employees);

select salary
  from (select salary, dense_rank() over(order by salary desc) as rn
          from hr.employees)
 where rn = 2;

select min(salary) from (
select distinct salary from hr.employees order by salary desc
) where rownum <= 2 ;



Q434. Query to find duplicate rows in table?

Answer:
select first_name,email,count(*) from hr.employees group by email,first_name
having count(*) > 1 ;

select *
  from (select e.*,
               row_number() over(partition by employee_id order by employee_id) as rn
          from hr.employees e)
 where rn > 1;

select *
  from (Select e.*,
               dense_rank() over(partition by employee_id order by employee_id) as rn
          from hr.employees e)
 where rn > 1;



Q435. How to fetch monthly Salary of Employee if annual salary is given?

Answer:
select e.* ,round(salary/12 ,2 ) as monthly_salay from hr.employees e ;
select e.* ,round(salary*12 ,2 ) as annual_salay from hr.employees e ;


-- What is the Query to fetch first record from Employee table?
select * from hr.employees where rownum = 1 ;

select * from (select e.*,row_number() over (order by employee_id) as rn from hr.employees e) where rn = 1;

-- What is the Query to fetch last record from the table?

select * from (select e.*,row_number() over (order by employee_id desc) as rn from hr.employees e) where rn = 1;

select * from (select * from hr.employees order by employee_id desc) where rownum <= 1;



Q436. What is Query to display last 5 Records from Employee table?

Answer:
select * from (select * from hr.employees order by employee_id desc) where rownum <= 5;

select * from (select e.*,row_number() over (order by employee_id desc) as rn from hr.employees e) where rn <= 5;


 select *
   from hr.employees
  where rownum <= (select count(*) from hr.employees)
 minus
 select *
   from hr.employees
  where rownum <= (select count(*) - 5 from hr.employees);



Q437. What is Query to display Nth Record from Employee table?

Answer:
select *
  from (select e.*, row_number() over(order by employee_id desc) as rn
          from hr.employees e)
 where rn = &_num;



Q438. How to get 3 Highest salaries records from Employee table?

Answer:
select *
  from (Select distinct e.*, row_number() over(order by salary desc) as rn
          from hr.employees e)
 where rn <= 3;



Q439. How to Display Odd rows in Employee table?

Answer:
select *
  from (Select  e.*, row_number() over(order by salary desc) as rn
          from hr.employees e)
 where mod(rn, 2) = 1;



Q440. How to Display Even rows in Employee table?

Answer:
select *
  from (Select  e.*, row_number() over(order by salary desc) as rn
          from hr.employees e)
 where mod(rn, 2) = 0;

 select * from hr.employees where mod(employee_id , 2 ) = 0



Q441. How Can i create table with same structure of Employee table?

Answer:
create table emp as select * from hr.employees where 1=0 ;



Q442. Display first 50% records from Employee table?

Answer:
select * from (
select * from hr.employees)
where rownum <= (select count(*)/2 from hr.employees) ;



Q443. Display last 50% records from Employee table?

Answer:
select * from (
select * from hr.employees order by employee_id desc)
where rownum <= (select count(*)/2 from hr.employees) ;



Q444. How to get distinct records from the table without using distinct keyword.

Answer:
select employee_id,email,salary from hr.employees
group by employee_id,email,salary ;

select * from hr.employees
union
select * from hr.employees;



Q445. Select all records from Employee table whose name is Amit and Pradnya

Answer:
select * from hr.employees
where first_name in ('Amit','Pradnya') ;

      select substr('tejas@gmail.com', instr('tejas@gmail.com','@')) from dual;

      select substr('tejas@gmail.com',1,instr('tejas@gmail.com','@')-1) from dual;

      select instr('tejas@gmail.com','@') from dual;

      select replace('tejas@gmail.com','tejas','pawartejas') from dual;

      select translate('tejas@gmail.com','tejas','pawartejas') from dual;



Q446. Select all records from Employee table where name not in Amit and Pradnya

Answer:
select * from hr.employees
where first_name not in ('Amit','Pradnya') ;



Q447. how to write sql query for the below scenario

Answer:
select substr('ORACLE',level,1) from dual
      connect by level<=length('ORACLE');

            select 'O' from dual
      union all
      select 'R' from dual
      union all
      select 'A' from dual
      union all
      select 'C' from dual
      union all
      select 'L' from dual
      union all
      select 'E' from dual;

      select listagg(first_name,',')within group (order by first_name asc) from hr.employees;

      select * from (select e.*, lead(salary)over(order by employee_id) as rn from hr.employees e);

      select * from (Select e.*, lag(salary)over(order by employee_id) as rn from hr.employees e);



Q448. How to fetch all the records from Employee whose joining year is 2017?

Answer:
select * from hr.employees
where extract(year from hire_date) = 2003;

select * from hr.employees
where to_char(hire_date,'yyyy') = '2003';



Q449. How Do you find all Employees with its managers?(Consider there is manager id also in Employee table)

Answer:
select e.employee_id,
          e.first_name  as employee_name,
          m.employee_id as manager_id,
          m.first_name  as manager_name
     from hr.employees e
     join hr.employees m
       on e.manager_id = m.employee_id;



Q450. Display the name of employees who have joined in 2016 and salary is greater than 10000?

Answer:
select * from hr.employees
where extract(year from hire_date) = 2004 and salary > 10000 ;



Q451. How to display following using query?

Answer:
*
**
***

     select '*' from dual
     union all
     select '**' from dual
     union all
     select '***' from dual;

select rpad('*',level,'*') from dual
connect by level <= 3 ;

select lpad('*',level,'*') from dual
connect by level <= 3 ;



Q452. How to Find the Joining date of Employee in YYYY

Answer:
select to_char(hire_date ,'yyyy-day-dd') from hr.employees ;



Q453. How to display 1 to 100 Numbers with query?

Answer:
select level from dual
connect by level <=100  ;

WITH nums(n) AS (
    SELECT 1 FROM dual
    UNION ALL
    SELECT n + 1 FROM nums WHERE n < 100
)
SELECT n FROM nums;



Q454. How to remove duplicate rows from table?

Answer:
delete from employees
        where employee_id in (select employee_id from employees group by employee_id having count(*)>1);

delete from hr.employees where rowid not in (
select min(rowid) from hr.employees group by employee_id);



Q455. How to find count of duplicate rows?

Answer:
select sum(cnt -1 )from (
select count(*) as cnt from hr.employees group by employee_id,email
having count(*) > 1) ;


/*For each department, find the employee(s) who earn the
SECOND HIGHEST salary.
Conditions:
If a department has less than 2 employees, do not return that department
If multiple employees share the same second highest salary, return all of them
Use ONLY SQL :
Output should include:
department_id
department_name
employee_id
salary*/

select *
  from (SELECT e.employee_id,
               d.department_name,
               e.department_id,
               salary,
               dense_rank() over(partition by e.department_id order by salary desc) second_high_sal,
               count(*) over(partition by e.department_id) as emp_cot
          from hr.employees e
          join hr.departments d
            on e.department_id = d.department_id)
 where emp_cot >= 2
   and second_high_sal = 2;

/*For each department, find the employee(s) who have the
LONGEST tenure (earliest hire_date).
Conditions:
If multiple employees joined on the same earliest date, return all of them
Do NOT use MIN(hire_date) directly in the select list
Use ONLY SQL
Output columns:
department_id
employee_id
hire_date*/

select employee_id, department_id, hire_date
  from hr.employees
 where (department_id, hire_date) in
       (select department_id, min(hire_date)
          from hr.employees
         group by department_id)
-- 
select *
  from (select employee_id,
               department_id,
               hire_date,
               dense_rank() over(partition by department_id order by hire_date asc) earliest_highest
          from hr.employees)
 where earliest_highest = 1
 order by department_id nulls first;

/*For each department, find the employee(s) whose salary is
GREATER than the department’s AVERAGE salary
but LESS than the department’s MAX salary.
Conditions:
Handle salary ties correctly
Return all qualifying employees
Use ONLY SQL
Output columns:
department_id
employee_id
salary
department_avg_salary
department_max_salary*/

select *
  from (select employee_id,
               department_id,
               salary,
               round(avg(salary) over(partition by department_id),2) department_avg_salary,
               max(salary) over(partition by department_id) department_max_salary
          from hr.employees)
 where salary > department_avg_salary
   and salary < department_max_salary;

/*Find departments where:
The department has at least 3 employees
The highest salary in the department is at least 2× the lowest salary
The department has at least one employee hired in each of the last 3 different years
Return:
department_id
department_name
total_employees
min_salary
max_salary
⚠️ Restrictions
❌ Window functions NOT allowed
❌ PL/SQL NOT allowed
✅ Use joins, GROUP BY, HAVING, subqueries
✅ SQL only*/

select *
  from (select d.department_id,
               d.department_name,
               count(employee_id) as total_employees,
               min(salary) as min_salary,
               max(salary) as max_salary
          from hr.employees e
          join hr.departments d
            on e.department_id = d.department_id
         WHERE EXTRACT(YEAR FROM e.hire_date) >=
               EXTRACT(YEAR FROM SYSDATE) - 2
         group by d.department_id, d.department_name
        having count(employee_id) >= 3)
 where max_salary >= 2 * min_salary;

-- 

/*PL/SQL – Question 1 (Cursor + Collection + Exception)
     Requirement
Write a procedure that:
Uses an explicit cursor
Fetches employees department-wise
Stores salaries in a collection
Raises a user-defined exception if average salary of any department is less than 6000
Prints department_id and average salary*/
CREATE OR REPLACE PROCEDURE dpt_avg IS

  CURSOR emp_cur IS
    SELECT department_id, AVG(salary) AS avg_sal
      FROM hr.employees
     GROUP BY department_id;

  TYPE emp_tab IS TABLE OF emp_cur%ROWTYPE;
  v_emp emp_tab;

  e_low_avg_salary EXCEPTION;

BEGIN
  OPEN emp_cur;
  FETCH emp_cur BULK COLLECT
    INTO v_emp;
  CLOSE emp_cur;

  FOR i IN 1 .. v_emp.COUNT LOOP

    IF v_emp(i).avg_sal < 6000 THEN
      DBMS_OUTPUT.PUT_LINE('Department ' || v_emp(i).department_id ||
                           ' average salary is below 6000: ' || v_emp(i)
                           .avg_sal);
      RAISE e_low_avg_salary;
    END IF;

    DBMS_OUTPUT.PUT_LINE('Department: ' || v_emp(i).department_id ||
                         ' | Avg Salary: ' || v_emp(i).avg_sal);

  END LOOP;

EXCEPTION
  WHEN e_low_avg_salary THEN
    DBMS_OUTPUT.PUT_LINE('User-defined exception raised.');
  WHEN OTHERS THEN
    DBMS_OUTPUT.PUT_LINE(DBMS_UTILITY.format_error_stack ||
                         DBMS_UTILITY.format_error_backtrace);
END;

-- 

begin
  dpt_avg;
end;

-- 
CREATE OR REPLACE PROCEDURE dpt_avg IS

  CURSOR emp_cur IS
    SELECT department_id,
           AVG(salary) AS avg_sal
    FROM hr.employees
    GROUP BY department_id;

  TYPE emp_tab IS TABLE OF emp_cur%ROWTYPE;
  v_emp emp_tab;

  e_low_avg_salary EXCEPTION;

BEGIN
  OPEN emp_cur;
  FETCH emp_cur BULK COLLECT INTO v_emp;
  CLOSE emp_cur;

  FOR i IN 1 .. v_emp.COUNT LOOP
    BEGIN
      IF v_emp(i).avg_sal < 6000 THEN
        RAISE e_low_avg_salary;
      END IF;

      DBMS_OUTPUT.PUT_LINE(
        'Department: ' || v_emp(i).department_id ||
        ' | Avg Salary: ' || v_emp(i).avg_sal
      );

    EXCEPTION
      WHEN e_low_avg_salary THEN
        DBMS_OUTPUT.PUT_LINE(
          'Department: ' || v_emp(i).department_id ||
          ' | Avg Salary: ' || v_emp(i).avg_sal ||
          '  <-- BELOW 6000'
        );
    END;
  END LOOP;

END;


select * from user_objects where object_name = 'DPT_AVG' ;
select * from user_source where name = 'DPT_AVG' ;
select * from user_errors where name = 'DPT_AVG' ;


/*PL/SQL – Question 2 (REF CURSOR + Function)
Requirement
Write a function that:
Accepts p_year
Returns a SYS_REFCURSOR             -- note use order table that have order_id,cust_id,ord_date,amount
Cursor should return:
       cust_id
       total order amount of that year
Only customers with total amount > 50,000*/

create or replace function ord_fun(p_year in number) return sys_refcursor is
  rc sys_refcursor;
begin
  open rc for
    select customer_id, sum(amount) as total_amount
      from orders1
     where extract(year from order_date) = p_year
     group by customer_id
    having sum(amount) > 100;

  return rc;
exception
  when others then
    dbms_output.put_line(dbms_utility.format_error_stack ||
                         dbms_utility.format_error_backtrace);
    raise;
end;

declare
  va      sys_refcursor;
  cust_id orders1.customer_id%type;
  total   number;
begin
  va := ord_fun(2025);
  loop
    fetch va
      into cust_id, total;
    exit when va%notfound;

    dbms_output.put_line(cust_id ||' total_ord_amount :' || total);
  end loop;
end;

select * from user_objects where object_name = ('ORD_FUN') ;
SELECT * FROM user_errors where name = ('ORD_FUN') ;
SELECT * FROM user_source where name = ('ORD_FUN') ;

select * from orders1;

/*PL/SQL – Question 3 (PRAGMA AUTONOMOUS_TRANSACTION)
Requirement
Write a procedure that:                                use -> SELECT * FROM transactions;
Updates transaction status                             use -> SELECT * FROM txn_log;
If update fails, logs error into TXN_LOG
Logging must be done using PRAGMA AUTONOMOUS_TRANSACTION
Main transaction must rollback, log must commit*/

SELECT
    emp_name || '(' || SUBSTR(emp_name, 1, 1) || ')' AS emp_display,
    CASE
        WHEN dept_id = 10 THEN
          'There are a total of ' || rn || ' doctors.'
        WHEN dept_id = 20 THEN
          'There are a total of ' || rn || ' engineers.'
        WHEN dept_id = 100 THEN
          'There are a total of ' || rn || ' HR.'

    END AS dpt_count
FROM (
    SELECT
        emp_name,
        dept_id,
        COUNT(*) OVER (PARTITION BY dept_id) AS rn
    FROM employees
)order by rn;


/*QUESTION 1 — JOIN + AGGREGATE (Classic Interview)
Find department name and total salary of departments where total salary > 10,000
Expected Output
dept_name	total_salary
HR	      12000
SALES	    9000 ❌ (excluded)*/

select department_name, sum(salary) as totalsalary
  from hr.employees e
  join hr.departments d
    on e.department_id = d.department_id
 group by department_name
having sum(salary) > 10000;


/*QUESTION 2 — CORRELATED SUBQUERY
     Requirement
Find employees who earn more than the average salary of their own department
Expected Output
| emp_id | emp_name | dept_id | salary |
| ------ | -------- | ------- | ------ |
| 2      | B        | 10      | 7000   |
| 3      | C        | 20      | 6000   |
| 5      | E        | 30      | 9000   |*/

select employee_id, first_name, department_id, salary
  from hr.employees de
 where salary > (select avg(salary)
                   from hr.employees d
                  where d.department_id = de.department_id);
-- 
select employee_id, first_name, department_id, salary
  from hr.employees e
 where salary > (select avg(salary)
                   from hr.employees d
                  where d.department_id = e.department_id);
-- 
with emp as
 (select employee_id, first_name, department_id, salary from hr.employees),
avg_sal as
 (select department_id, avg(salary) as avg_salary
    from hr.employees
   group by department_id)
select employee_id, first_name, e.department_id, salary
  from emp e
 where salary > (select avg_salary
                   from avg_sal a
                  where e.department_id = a.department_id);
-- 
with emp as
 (select employee_id, first_name, department_id, salary from hr.employees)
select employee_id, first_name, e.department_id, salary
  from emp e
 where salary > (select avg(salary) as avg_sal
                   from hr.employees a
                  where e.department_id = a.department_id);


/*QUESTION 3 — ANALYTICAL FUNCTION
     Requirement
Find the 2nd highest salary in each department
Expected Output
| dept_id | emp_name | salary |
| ------- | -------- | ------ |
| 10      | A        | 5000   |
| 20      | D        | 4000   |
| 30      | NULL     | NULL   |*/
select department_id, first_name, salary
  from (select department_id,
               first_name,
               salary,
               dense_rank() over(partition by department_id order by salary desc) as rn
          from hr.employees)
 where rn = 2;


/*QUESTION 4 — CASE EXPRESSION
     Requirement
Classify employees:
salary < 5000 → LOW
5000–7000 → MEDIUM
7000 → HIGH
Expected Output
| emp_name | salary | grade  |
| -------- | ------ | ------ |
| A        | 5000   | MEDIUM |
| B        | 7000   | MEDIUM |
| C        | 6000   | MEDIUM |
| D        | 4000   | LOW    |
| E        | 9000   | HIGH   |*/

select first_name,
       salary,
       case
         when salary < 5000 then
          'Low'
         when salary between 5000 and 7000 then
          'Medium'
         when salary > 7000 then
          'High'
       end as grade
  from hr.employees;



/*QUESTION 5 — ANTI JOIN (IMPORTANT     )
Requirement
Find employees who never placed an order
Expected Output
| emp_id | emp_name |
| ------ | -------- |
| 3      | C        |
| 4      | D        |
| 5      | E        |*/

select employee_id, first_name
  from employee e   --query is correct but not executable because colum table not any relationship
 where not exists
 (select 1 from orders o where e.employee_id = o.employee_id);


/*QUESTION 6 — CTE + AGGREGATE
     Requirement
Using a CTE, find departments whose employee count is greater than the average
employee count across all departments.
Expected Output
| dept_id | emp_count |
| ------- | --------- |
| 10      | 2         |
| 20      | 2         |*/

with emp as (
select department_id,count(*) as emp_count
from hr.employees
group by department_id )
select department_id,emp_count from emp
where emp_count > (select avg(emp_count) from emp ) ;



/*QUESTION 8 — SUBQUERY IN SELECT
     Requirement
Display employee name, salary, and department average salary in the same row
✅ Expected Output
| emp_name | salary | dept_avg_salary |
| -------- | ------ | --------------- |
| A        | 5000   | 6000            |
| B        | 7000   | 6000            |
| C        | 6000   | 5000            |
| D        | 4000   | 5000            |
| E        | 9000   | 9000            |*/

select first_name,
       salary,
       (select trunc(avg(salary))
          from hr.employees d
         where e.department_id = d.department_id) as dept_avg_salary
  from hr.employees e;



/*QUESTION 9 — VIEW (COMPLEX)
     Requirement
Create a view that shows:
dept_id
total salary
average salary
The view must be non-updatable.
✅ Expected Output (View Data)
| dept_id | total_salary | avg_salary |
| ------- | ------------ | ---------- |
| 10      | 12000        | 6000       |
| 20      | 10000        | 5000       |
| 30      | 9000         | 9000       |*/

create view emp_sum_avg_sal as
select department_id,trunc(sum(salary)) as total_salary,avg(salary) as avg_salary
from hr.employees
group by department_id
with read only;

select * from emp_sum_avg_sal ;

/*QUESTION 10 — EXECUTION PLAN LOGIC (INTERVIEW THEORY + SQL)
Queries
SELECT * FROM emp WHERE emp_id = 1;
SELECT * FROM emp WHERE emp_id = 2;
     Requirement
Explain:
Hard parse or soft parse?
Why execution plan is reused?
(No SQL writing — explanation only)*/

Ans:= for firt query it use hard parse but for second query it use soft parsh because of literal change only
 sql use same execution plane for those query who have litreal change only.

Ans:= “The first query causes a hard parse because Oracle has to parse, optimize, and
      generate an execution plan. The second query uses soft parse because the SQL
      structure is the same and only the literal value is different, so Oracle can reuse the
      existing execution plan from the shared pool.”



Q456. Q.17 Total Cost to purchase the Color and name the color purchased.

Answer:
select s.spname,total
from purchase p
join sparepart s on p.spid = s.spid
where s.spname like '%COLOUR%';

select * from sparepart ;

select item_name, sum(quantity * price_per_unit) as total_cost from purchase
where item_name like '%color%'
group by item_name;



Q457. Q.18 Purchased Items which are not used in "Ser_det".

Answer:
select item_name
from sparepart
where item_id not in (select distinct item_id from ser_det);



Q458. Q.20 Calculate the Profit/Loss of the Firm. consider one month salary of each employee for Calculation.

Answer:
select  e.ename,sum(e.esal) - sum(s.total) as "profit and loss"
from employe e
join ser_det s on e.eid = s.eid
group by e.ename;



Q459. Write create table syntax for employee table and Incentive table

Answer:
CREATE TABLE employee (
    emp_id          NUMBER(10)      PRIMARY KEY,
    first_name      VARCHAR2(50),
    last_name       VARCHAR2(50),
    salary          NUMBER(10, 2),
    joining_date    DATE,
    department      VARCHAR2(50)
);

CREATE TABLE incentives (
    employee_ref_id    NUMBER(10),
    incentive_date     DATE,
    incentive_amount   NUMBER(10, 2)
   );



Q460. Get FIRST_NAME, Joiningyear, Joining Month and Joining Date from employee table

Answer:
select first_name,
       to_char(joining_date, 'YYYY') as "joining year",
       to_char(joining_date, 'MM') as "joining month",
       to_char(joining_date, 'DD') as "joining date"
from employee;



Q461. Select no of employees joined with respect to year and month from employee table.

Answer:
select joining_date, count(emp_id) from employee
group by joining_date;

SELECT
    TO_CHAR(joining_date, 'YYYY') AS joining_year,
    TO_CHAR(joining_date, 'Month') AS joining_month,
    COUNT(emp_id) AS no_of_employees
FROM
    employee           -- This is right Query
GROUP BY
    TO_CHAR(joining_date, 'YYYY'),
    TO_CHAR(joining_date, 'Month')
ORDER BY
    joining_year,
    joining_month;



Q462. Select max incentive with respect to employee from employee and incentives table using sub query.

Answer:
select first_name, (
select max(incentive_amount) from incentives
where emp_id=employee_ref_id)      ---Not Clear This Q
from employees;

-Categorize Employees by Salary Range
Requirement:
"High" → salary ≥ 5000
"Medium" → 4000 ≤ salary < 5000
"Low" → salary < 4000

select emp_name,salary,
       emp_id,
       case
         when salary > 60000 then
          'High'
         when salary >= 50000 then
          'Medium'
         when salary < 50000 then
          'Low'
       end as salary_category
  from employees1
         order by salary_category desc;


-- Department Code Mapping
-- Requirement:
-- Map IT → D01, HR → D02, Finance → D03, else D00.

select emp_id,
       emp_name,
       department, decode(department, 'IT', 'D01', 'HR', 'D02', 'Finance', 'D03', 'D00') as dept_code
  from employees1
  order by department;



Q463. – Custom Sorting by Department

Answer:
select emp_id, emp_name, department
  from employees1
 order by case department
            when 'Finance' then
             1
            when 'IT' then
             2
            when 'HR' then
             3
          end;



Q464. – Bonus Eligibility

Answer:
select emp_id,
       emp_name,
       salary,
       case
         when salary >= 50000 then
          'Yes'
         else
          'No'
       end as Bonus_Eligibility
  from employees1;


SELECT emp_name,
       DECODE(
           department || CASE WHEN salary > 4500 THEN '1' ELSE '0' END,
           'IT1', 'Yes',
           'No'
       ) AS bonus_eligibility
FROM employees1;



Q465. – Dynamic Commission % Based on Salary

Answer:
Requirement:
Salary ≥ 5000 → 10% commission
Salary between 4000 and 4999 → 7% commission
Else 5% commission

select emp_id,
       emp_name,
       case
         when Salary ≥ 5000 then
          salary * 0.10
         when salary between 4000 and 4999 then
          salary * 0.07
         else
          salary + 0.05
       end as commission
  from employees1;



Q466. Output the category in uppercase, and also show the first three letters of the employee name.

Answer:
SELECT SUBSTR(emp_name, 1, 3) AS name_prefix,
       salary,
       CASE
           WHEN (salary * 12) >= 600000 THEN UPPER('high')
           WHEN (salary * 12) >= 500000 THEN UPPER('medium')
           ELSE UPPER('low')
       END AS annual_category
FROM employees1;

select * from employees1 ;

/*Requirement
Write a query to display:
emp_name and dept_short (from DECODE) where:
IT → TECH
HR → HUMAN
Finance → FIN
Else → OTHER
salary_category (from CASE) where:
Salary ≥ 5000 → HIGH
Salary between 4000 and 4999 → MEDIUM
Else → LOW
experience_years (calculated using MONTHS_BETWEEN(SYSDATE, hire_date)/12, rounded down)
experience_level (from CASE on experience_years):
≥ 10 years → SENIOR
5 to 9 years → MID
Else → JUNIOR
Group the results by department, show avg salary per department.
Sort results by avg salary descending.
*/

select department,
       decode(department,
              'IT',
              'Tech',
              'Fnance',
              'Fin',
              'HR',
              'Human',
              'Other') as dept_specification,
       ROUND(AVG(salary), 2) AS avg_salary,

       case
         when salary >= 50000 then
          'High'
         when salary between 40000 and 50000 then
          'Medium'
         else
          'Low'
       end as salary_specification,
       FLOOR(MONTHS_BETWEEN(SYSDATE, MIN(hire_date)) / 12) AS experience_years,
       CASE
         WHEN FLOOR(MONTHS_BETWEEN(SYSDATE, MIN(hire_date)) / 12) >= 10 THEN
          'SENIOR'
         WHEN FLOOR(MONTHS_BETWEEN(SYSDATE, MIN(hire_date)) / 12) >= 5 THEN
          'MID'
         ELSE
          'JUNIOR'
       END AS experience_level
  FROM hr.employees
 GROUP BY department
 ORDER BY avg_salary DESC;

select * from hr.employees

-- 
SELECT *
FROM employees
WHERE CASE
          WHEN department = 'IT' THEN
               CASE WHEN salary > 4500 THEN 'Y' ELSE 'N' END
          WHEN department = 'HR' THEN
               CASE WHEN salary > 3500 THEN 'Y' ELSE 'N' END
          ELSE 'N'
      END = 'Y';
-- 
SELECT *
FROM hr.departments
WHERE DECODE(department_name, 'IT', 'Y', 'Finance', 'Y', 'N') = 'Y';
--



Q467. Example – Show departments where the total salary of HIGH earners (>5000) is above 10,000

Answer:
SELECT department,
       SUM(CASE WHEN salary > 5000 THEN salary ELSE 0 END) AS high_salary_total
FROM employees
GROUP BY department
HAVING SUM(CASE WHEN salary > 5000 THEN salary ELSE 0 END) > 10000;

--



Q468. Show departments where the total salary for IT employees is above 8,000

Answer:
SELECT department,
       SUM(DECODE(department, 'IT', salary, 0)) AS it_salary_total
FROM employees
GROUP BY department
HAVING SUM(DECODE(department, 'IT', salary, 0)) > 8000;



Q469. Scenario: Show employees who have different filtering logic based on department.

Answer:
SELECT employee_id, First_name, department_id, salary
FROM hr.employees
WHERE
    CASE
        WHEN department_id = 50 THEN salary
        WHEN department_id = 30 THEN salary * 1.10
        ELSE NULL
    END > 8000;

select * from hr.employees ;

-- Scenario: Departments where bonus or average salary meets specific rules.

SELECT dept_id,
       SUM(bonus) AS total_bonus,
       AVG(salary) AS avg_sal
FROM employees
GROUP BY dept_id
HAVING
    CASE
        WHEN dept_id = 10 THEN SUM(bonus)
        WHEN dept_id = 20 THEN AVG(salary)
        ELSE NULL
    END > 2000;



Q470. For each employee, display:

Answer:
employee_id, first_name, department_id, salary_category
Salary category rules:
"High" if salary > department's average salary
"Equal" if salary = department's average salary
"Low" if salary < departments average salary
Use CASE inside SELECT.

select e.employee_id,
       e.first_name,
       e.department_id,
       e.salary,
       CASE
         when e.salary >
              (select avg(salary) from hr.employees where department_id = e.department_id ) then
          'High'
         when e.salary =
              (select avg(salary) from hr.employees where department_id = e.department_id) then
          'Equal' else
          'Low'
       end as salary_category
  from hr.employees e;



Q471. Display employees:

Answer:
If department_id = 50 → only show those earning > 5000
If department_id = 60 → only show those earning > 8000
For all others → only show those earning > 10000
Use CASE inside WHERE.

SELECT employee_id,
       first_name,
       department_id,
       salary
FROM hr.employees
WHERE
    CASE
        WHEN department_id = 50 THEN salary
        WHEN department_id = 60 THEN salary
        ELSE salary
    END >
    CASE
        WHEN department_id = 50 THEN 5000
        WHEN department_id = 60 THEN 8000
        ELSE 10000
    END
    order by department_id;


SELECT employee_id, first_name, department_id, salary
  from hr.employees
 where salary > case
         WHEN department_id = 50 THEN
          8000
         WHEN department_id = 60 THEN
          8000
         ELSE
          10000
       END;



Q472. For each country, show:

Answer:
country_name
Number of employees in departments located in that country,
separating counts for US and UK using DECODE.

select count(e.employee_id),
       decode(c.country_name,
              'United Kingdom',
              'UK',
              'United States of America',
              'US')
  from hr.employees e
  join hr.departments d
    on e.department_id = d.department_id
  join hr.locations l
    on d.location_id = l.location_id
  join hr.countries c
    on l.country_id = c.country_id
 group by c.country_name
having c.country_name in ( 'United Kingdom' , 'United States of America');

-- This was real answer
SELECT SUM(DECODE(c.country_name, 'United Kingdom', 1, 0)) AS uk_count,
       SUM(DECODE(c.country_name, 'United States of America', 1, 0)) AS us_count
  FROM hr.employees e
  JOIN hr.departments d
    ON e.department_id = d.department_id
  JOIN hr.locations l
    ON d.location_id = l.location_id
  JOIN hr.countries c
    ON l.country_id = c.country_id
 WHERE c.country_name IN ('United Kingdom', 'United States of America');



Q473. Conditional Aggregation with DECODE

Answer:
Count employees whose salary is above 10000
Count employees whose salary is 10000 or below
Use DECODE + aggregate functions.


SELECT department_id,
       SUM(DECODE(GREATEST(salary, 10001), salary, 0, 1)) AS above_10000,
       SUM(DECODE(LEAST(salary, 10000), salary, 0, 1)) AS at_or_below_10000
  FROM hr.employees
 GROUP BY department_id;

SELECT
    department_id,
    SUM(DECODE(SIGN(salary - 10000), 1, 1, 0)) AS above_10000,
    SUM(DECODE(SIGN(10000 - salary), 1, 1, 0)) AS at_or_below_10000
FROM hr.employees
GROUP BY department_id;



Q474. CASE in JOIN condition

Answer:
For employees in department 90 → match only job history rows from the year 2001
For others → match only job history rows from year 2005
Use CASE in the ON clause.

SELECT e.employee_id,
       e.department_id,
       jh.start_date,
       jh.end_date,
       jh.job_id
  FROM hr.employees e
  JOIN hr.job_history jh
    ON e.employee_id = jh.employee_id
   AND EXTRACT(YEAR FROM jh.start_date) = CASE
         WHEN e.department_id = 90 THEN
          2001
         ELSE
          2005
       END;




select * from hr.countries;
select * from hr.departments;
select * from hr.employees;
select * from hr.locations;
select * from hr.job_history;



-- 
*********************************************************************************************************
                                    Pivot & Unpivot



Q475. Requirement: Show each department with count of employees in each job role.

Answer:
select *
  from (select employee_id, department_id, job_id from hr.employees)
pivot(count(employee_id)
   for job_id in('AD_ASST' AS AD_ASST,
                 'MK_MAN' AS MK_MAN,
                 'MK_REP' AS MK_REP,
                 'PU_MAN' AS PU_MAN,
                 'PU_CLERK' AS PU_CLERK,
                 ANY AS TOTAL_EMP))
                 ORDER BY department_id;

select * from hr.employees ;

SELECT p.*,
       NVL(AD_ASST,0) + NVL(MK_MAN,0) + NVL(MK_REP,0) + NVL(PU_MAN,0) + NVL(PU_CLERK,0) AS TOTAL_EMP
FROM (
    SELECT *
    FROM (
        SELECT department_id, job_id, employee_id
        FROM hr.employees
    )
    PIVOT (
        COUNT(employee_id)
        FOR job_id IN (
            'AD_ASST' AS AD_ASST,
            'MK_MAN' AS MK_MAN,
            'MK_REP' AS MK_REP,
            'PU_MAN' AS PU_MAN,
            'PU_CLERK' AS PU_CLERK
        )
    )
) p
ORDER BY department_id;



Q476. Requirement: Show each department’s total salary by hire year.

Answer:
select * from (
select department_id ,to_char(hire_date, 'YYYY') as hire_year,salary)
pivot(sum(salary) for


-- High Salary Filter



Q477. Create a CTE to select employees with salary > 12000. Display their employee_id, first_name, salary.

Answer:
WITH emp AS (
    SELECT employee_id, first_name, salary
    FROM hr.employees
    WHERE salary > 12000
)
SELECT employee_id, first_name, salary
FROM emp;


-- Department Total Salary



Q478. Using a CTE, calculate total salary for each department. Show department_id, total_salary.

Answer:
with total_dpt as(
     select sum(salary) as total_salary ,department_id
     from hr.employees
     group by department_id
)
select department_id,total_salary from total_dpt ;


-- Employees Above Department Average
-- First CTE: calculate average salary per department.



Q479. Second CTE: select employees who earn above their department average.

Answer:
WITH dept_avg AS (
    SELECT department_id,
           AVG(salary) AS avg_salary
    FROM hr.employees
    GROUP BY department_id
),
emp_above_avg AS (
    SELECT e.employee_id,
           e.first_name,
           e.salary,
           e.department_id
    FROM hr.employees e
    JOIN dept_avg d ON e.department_id = d.department_id
    WHERE e.salary > d.avg_salary
)
SELECT *
FROM emp_above_avg;


-- Top 5 Highest Salaries (Company
-- Use ROW_NUMBER() inside a CTE to fetch top 5 employees by salary.

with top_emp as (
     select employee_id,first_name,salary,
     row_number() over (order by salary desc) ranked_salary
     from hr.employees
)
select * from top_emp where ranked_salary <= 5
order by ranked_salary  ;


-- Top 3 Highest Salaries Per Department
-- Use ROW_NUMBER() in a CTE with PARTITION BY department_id.

with top_emp as (
     select employee_id,first_name,salary,department_id,
     row_number() over (partition by department_id order by salary desc) ranked_salary
     from hr.employees
)
select * from top_emp where ranked_salary <= 3
ORDER BY department_id, ranked_salary;


-- Department % Contribution
-- CTE1: Department total salary.
-- CTE2: Company total salary.
-- Final query: each department’s salary as % of company salary.

with dpt_sal as (
     select sum(salary) as dpt_total_sal,department_id
     from hr.employees
     group by department_id
),
com_sal as (
        select sum(dpt_total_sal) as comp_sal
        from dpt_sal
)
select d.department_id,
       d.dpt_total_sal,
       round(d.dpt_total_sal/c.comp_sal * 100,2 ) as percent_sal
       from dpt_sal d
       cross join com_sal c order by percent_sal desc;


-- Employees Hired in Last 90 Days
-- CTE: Filter employees hired within 8000 days.
-- Use it to insert into new_hires_audit.

CREATE TABLE new_hires_audit AS
SELECT employee_id,
       first_name,
       last_name,
       hire_date,
       department_id,
       salary
FROM hr.employees
WHERE 1=0;   -- creates empty table with same structure

INSERT INTO new_hires_audit
      (employee_id, first_name, last_name, hire_date, department_id, salary)
WITH emp_hired AS (
   SELECT employee_id,
          first_name,
          last_name,
          hire_date,
          department_id,
          salary
   FROM hr.employees
   WHERE hire_date >= SYSDATE - 8000
)
SELECT employee_id,
       first_name,
       last_name,
       hire_date,
       department_id,
       salary
FROM emp_hired;

select * from new_hires_audit ;


-- Employees Without Managers



Q480. Use a CTE to find employees whose manager_id is null (top

Answer:
with emp_man as (
     select  employee_id,first_name
     from hr.employees
     where manager_id is null
)
select * from emp_man ;


-- Delete Duplicate Emails
-- In a CTE, rank employees by ROW_NUMBER() partitioned by email.
-- Keep rn=1, delete others.

DELETE FROM employees
WHERE employee_id IN (        --it's not an CTE
    SELECT employee_id
    FROM (
        SELECT employee_id,
               ROW_NUMBER() OVER (PARTITION BY email ORDER BY employee_id) AS rn
        FROM employees
    )
    WHERE rn > 1
);


-- Employees with Multiple Jobs



Q481. Using a CTE, find employees who have more than one job record in job_history.

Answer:
with mul_job as (
     select employee_id,count(job_id) as total_job
     from hr.job_history
     group by employee_id
     having count(job_id) > 1
)
select e.employee_id,e.first_name,b.total_job
from hr.employees e
join mul_job b on e.employee_id = b.employee_id ;

select * from hr.job_history


-- Second Highest Salary per Department



Q482. Use DENSE_RANK() inside a CTE to find 2nd highest salary in each department.

Answer:
with high_sal as (
     select employee_id,first_name,department_id,salary,
     dense_rank() over (partition by department_id order by salary desc) as dr
     from hr.employees
)
select * from high_sal where dr = 2 ;



Q483. Create a CTE for employees left join departments → find where department_id is null.

Answer:
with no_dpt_emp as (
     select employee_id,first_name,e.department_id
     from hr.employees e left join hr.departments d
     on e.department_id = d.department_id
     where e.department_id is null
)
select * from no_dpt_emp ;


-- Salary Brackets
-- Use a CTE to classify employees into brackets:
-- Low (<5000), Medium (5000–10000), High (>10000).



Q484. Count employees in each bracket.

Answer:
with salary_classify as
 (select employee_id,
         first_name,
         salary,
         case
           when salary < 5000 then
            'Low'
           when salary between 5000 and 10000 then
            'Medium'
           when salary > 10000 then
            'High'
         end as sal_classify
    from hr.employees)
select count(*),sal_classify from salary_classify
group by sal_classify;

-- Recursive CTE
-- We want to see all employees under the CEO (who has no manager), including their level in the hierarchy.

WITH emp_hierarchy (employee_id, first_name, manager_id, level_no) AS (
    SELECT employee_id, first_name, manager_id, 1 AS level_no
    FROM   hr.employees
    WHERE  manager_id IS NULL   -- CEO (top level)

    UNION ALL

    SELECT e.employee_id, e.first_name, e.manager_id, eh.level_no + 1
    FROM   hr.employees e
           JOIN emp_hierarchy eh
           ON e.manager_id = eh.employee_id
)
SELECT *
FROM   emp_hierarchy
ORDER  BY level_no, employee_id;



Q485. Write a recursive CTE that generates numbers from 1 to 10 (no CONNECT BY, no numbers table).

Answer:
with add_number (n) as(
select 1 from dual

union all

select n + 1 from add_number
where n < 10
)
select * from add_number ;



Q486. Given an employee_id, find the chain of all managers up to the CEO.

Answer:
WITH manager_chain (employee_id, first_name, manager_id, level_no) AS (
    SELECT employee_id, first_name, manager_id, 1 AS level_no
    FROM   hr.employees
    WHERE  employee_id = 104

    UNION ALL

    SELECT e.employee_id, e.first_name, e.manager_id, mc.level_no + 1
    FROM   hr.employees e
           JOIN manager_chain mc
           ON e.employee_id = mc.manager_id
)
SELECT *
FROM   manager_chain
ORDER  BY level_no;



Q487. Write a recursive CTE to generate all even numbers from 2 to 20.

Answer:
WITH even_numbers (n) AS (
    SELECT 2 FROM dual

    UNION ALL

    SELECT n + 2
    FROM   even_numbers
    WHERE  n < 20
)
SELECT *
FROM   even_numbers;



Q488. Write a recursive CTE to generate all odd numbers from 1 to 20.

Answer:
WITH even_numbers (n) AS (
    SELECT 1 FROM dual

    UNION ALL

    SELECT n + 2
    FROM   even_numbers
    WHERE  n < 20
)
SELECT *
FROM   even_numbers;


-- Generate the first 10 numbers of the Fibonacci sequence using a recursive CTE.

WITH fib (n1, n2, level_no) AS (
    SELECT 0, 1, 1
    FROM   dual

    UNION ALL

    SELECT n2, n1 + n2, level_no + 1
    FROM   fib
    WHERE  level_no < 10   -- limit to 10 numbers
)
SELECT n1 AS fibonacci_number
FROM   fib;


-- Materialized Views
-- Aggregates are often pre

CREATE MATERIALIZED VIEW monthly_sales_summary
BUILD IMMEDIATE
REFRESH FAST ON COMMIT
AS
SELECT EXTRACT(MONTH FROM sale_date) month_no,
       SUM(amount) total_sales
FROM sales
GROUP BY EXTRACT(MONTH FROM sale_date);



Q489. Find the department(s) that have the maximum number of employees.

Answer:
SELECT department_id, COUNT(*) AS emp_count
FROM hr.employees
GROUP BY department_id
HAVING COUNT(*) = (
    SELECT MAX(COUNT(*))
    FROM hr.employees
    GROUP BY department_id
);

select * from (
SELECT department_id, COUNT(*) AS emp_count
FROM hr.employees
GROUP BY department_id
order by  COUNT(*) desc
)
where rownum = 1



Q490. How to find the 2nd highest salary without using ROWNUM?”

Answer:
select max(salary) as second_highest
from hr.employees
where salary < (select max(salary) from hr.employees) ;



Q491. How would you list employees earning more than their department’s average salary?”

Answer:
SELECT e.first_name, e.salary, e.department_id
FROM hr.employees e
WHERE salary > (
    SELECT AVG(salary)
    FROM hr.employees
    WHERE department_id = e.department_id
);


-- “Which department spends the most on salaries?”

select * from (
select department_id,sum(salary)
from hr.employees
group by department_id
order by sum(salary) desc
)
where rownum = 1 ;



Q492. Find salary difference between highest and lowest paid employee per department.

Answer:
SELECT department_id, MAX(salary) - MIN(salary) AS diff
FROM hr.employees
GROUP BY department_id;



Q493. Show percentage contribution of each employee to total department salary.

Answer:
SELECT first_name, department_id, salary,
       ROUND(salary * 100 / SUM(salary) OVER (PARTITION BY department_id), 2) AS pct
FROM hr.employees;



Q494. Query to find Second Highest Salary of Employee?

Answer:
select max(salary) from hr.employees
where salary < (select max(salary) from hr.employees);

select min(salary) from (
select salary
 from hr.employees
 order by salary desc )
where rownum <= 2;

select salary from (select salary, rownum as rn from hr.employees order by salary desc) where rn=2;



Q495. Query to find duplicate rows in table?

Answer:
select email,count(email) from hr.employees
group by email
having count(email) > 1 ;

SELECT first_name, last_name, email, COUNT(*)
FROM hr.employees
GROUP BY first_name, last_name, email
HAVING COUNT(*) > 1;


select * from  (select employee_id,
row_number() over (partition by email order by email) as rn
from hr.employees )
where rn > 1 ;

select * from hr.employees
where employee_id in (select employee_id from hr.employees group by employee_id having count(*) > 1) ;



Q496. How to fetch monthly Salary of Employee if annual salary is given?

Answer:
select employee_id,first_name,trunc(salary / 12) from hr.employees;


-- What is the Query to fetch first record from Employee table?

select * from hr.employees where rownum = 1 ;


-- What is the Query to fetch last record from the table?

SELECT *
FROM (
    SELECT *
    FROM hr.employees
    ORDER BY employee_id DESC
)
WHERE ROWNUM = 1;

select * from hr.employees
where employee_id in (select max(employee_id) from hr.employees ) ;



Q497. What is Query to display last 5 Records from Employee table?

Answer:
SELECT *
FROM (
    SELECT *
    FROM hr.employees
    ORDER BY employee_id DESC
)
WHERE ROWNUM <= 5;

select * from (
select e.*,row_number() over (order by employee_id desc) as rn from hr.employees e )
where rn <= 5 ;

SELECT *
FROM hr.employees
MINUS
SELECT *
FROM (
    SELECT *
    FROM hr.employees
    ORDER BY employee_id
)
WHERE ROWNUM <= (SELECT COUNT(*) - 5 FROM hr.employees);


select * from hr.employees e
where rownum <= (select count(*) from hr.employees )
minus
select * from hr.employees e
where rownum <= (select count(*)-5 from hr.employees ) ;



Q498. What is Query to display Nth Record from Employee table?

Answer:
select * from (select e.* ,
row_number() over (order by employee_id ) as rn
from hr.employees e )
where rn = &num ;

select * from (select e.* ,rownum as rn
from hr.employees e )
where rn = &num ;



Q499. How to get 3 Highest salaries records from Employee table?

Answer:
select * from (select e.* ,
row_number() over (order by salary desc ) as rn
from hr.employees e )
where rn <= 3 ;

select * from (
select e.* ,rownum as rn from hr.employees e)
where rownum <= 3 ;

select * from (select e.* ,
dense_rank() over (order by salary desc ) as rn
from hr.employees e )
where rn <= 3 ;

select * from hr.employees ;



Q500. How to Display Odd rows in Employee table?

Answer:
select * from (select e.* ,
row_number() over (order by employee_id desc ) as rn
from hr.employees e )
where mod(employee_id, 2) != 0 ;

select * from (
select e.* ,rownum as rn from hr.employees e)
where mod(employee_id, 2) != 0 ;



Q501. How to Display Even rows in Employee table?

Answer:
select * from (select e.* ,
row_number() over (order by employee_id desc ) as rn
from hr.employees e )
where mod(employee_id, 2) = 0


SELECT *
FROM (
    SELECT e.*, ROWNUM AS rn
    FROM hr.employees e
)
WHERE MOD(employee_id, 2) = 0;



Q502. How to fetch 3rd highest salary using Rank Function?

Answer:
select * from (
select e.*, row_number() over (order by salary desc) as rn from hr.employees e)
where rn = 4 ;

select min(salary) from (
select e.*,rownum as rn from hr.employees e order by salary desc)
where rn <= 4 ;



Q503. Display first 50% records from Employee table?

Answer:
select employee_id,first_name,email,count(*) from hr.employees
group by employee_id,first_name,email
having (count(*)/2) ; --wrong

 select * from (select e.*, rownum as rn from hr.employees e )
    where rn <= (select count(*)/2 from hr.employees);

    select * from hr.employees
    where rownum <=  (select count(*)/2 from hr.employees);



Q504. Display last 50% records from Employee table?

Answer:
select * from (select e.*, rownum as rn from hr.employees e )
    where rn >= (select count(*)/2 from hr.employees);

   select * from (
    select * from hr.employees
    where rownum<=(select count(*)/2 from hr.employees) order by employee_id desc)
    order by employee_id asc;

select *
  from (select e.*,
               row_number() over(order by employee_id desc) as rn,
               count(*) over() as total_count
          from hr.employees e)
 where rn <= total_count / 2
 order by employee_id;

 select * from hr.employees
 where rownum <=(select count(*) from hr.employees )
 minus
  select * from hr.employees
 where  rownum <=(select count(*)/2 from hr.employees )



Q505. Find Query to get information of Employee where Employee is not assigned to the department

Answer:
select * from hr.employees
where employee_id  in (select employee_id from hr.employees where department_id is null );

 select * from hr.employees
     where department_id is null;



Q506. How to get distinct records from the table without using distinct keyword.

Answer:
select * from hr.employees
union
select * from hr.employees;

select employee_id,first_name,last_name,email,salary  from hr.employees
group by employee_id,first_name,last_name,email,salary  ;



Q507. Select all records from Employee table whose name is Amit and Pradnya

Answer:
select * from hr.employees
where first_name in('Amit','Pradnya');



Q508. Select all records from Employee table where name not in Amit and Pradnya

Answer:
select * from hr.employees
where first_name not in('Amit','Pradnya');



Q509. how to write sql query for the below scenario

Answer:
O/p:
O
R
A
C
L
E

select 'O' from dual
union all
select 'R' from dual
union all
select 'A' from dual
union all
select 'C' from dual
union all
select 'L' from dual
union all
select 'E' from dual ;

select substr('ORACLE',level,1) from dual
connect by level<=length('ORACLE') ;



Q510. How to fetch all the records from Employee whose joining year is 2017?

Answer:
select * from hr.employees
where extract(YEAR from hire_date) = 2003;

select * from hr.employees
where to_char(hire_date,'yyyy') = 2003 ;



Q511. What is SQL Query to find maximum salary of each department?

Answer:
select max(salary) ,department_id from hr.employees
group by department_id
order by max(salary) desc ;



Q512. How Do you find all Employees with its managers?(Consider there is manager id also in Employee table)

Answer:
select * from hr.employees
where employee_id in (select manager_id from hr.employees) ;

SELECT e.employee_id,
       e.first_name AS employee_name,
       m.employee_id AS manager_id,
       m.first_name AS manager_name
FROM hr.employees e
LEFT JOIN hr.employees m
       ON e.manager_id = m.employee_id
ORDER BY e.employee_id;



Q513. Display the name of employees who have joined in 2016 and salary is greater than 10000?

Answer:
select first_name || ' ' || last_name from hr.employees
where extract(YEAR from hire_date) = 2003 and salary > 10000;

select first_name || ' ' || last_name from hr.employees
where to_char(hire_date,'yyyy') = 2003 and salary > 10000;

/*
26.How to display following using query?

*
**
***
*/

select lpad('*',level,'*') from dual
connect by level <= 3 ;



Q514. How to display 1 to 100 Numbers with query?

Answer:
WITH numbers (n) AS (
    SELECT 1 FROM dual
    UNION ALL
    SELECT n + 1
    FROM numbers
    WHERE n < 100
)
SELECT n
FROM numbers;


select level from dual
connect by level <= 100;



Q515. How to remove duplicate rows from table?

Answer:
delete from employees
    where employee_id in(select employee_id from employees group by employee_id having count(*)>1);


select *  FROM employees e
WHERE ROWID > (
    SELECT MIN(ROWID)
    FROM employees
    WHERE employees.email = e.email
);

    delete from employees
    where employee_id in(select employee_id from employees group by employee_id having count(*)>1);

DELETE FROM employees
WHERE ROWID IN (
    SELECT rid
    FROM (
        SELECT ROWID AS rid,
               ROW_NUMBER() OVER (PARTITION BY email ORDER BY employee_id) AS rn
        FROM employees
    )
    WHERE rn > 1
);



Q516. How to find count of duplicate rows?

Answer:
select count(*) from hr.employees
      group by employee_id
      having count(*)>1;



Q517. How to Find the Joining date of Employee in YYYY

Answer:
select to_char(hire_date,'yyyy-day-dd') from hr.employees;


*
Using a CTE, find departments where:
The department has more than the average number of employees per department
The department’s average salary is higher than the overall company average salary
Return:
department_id
total_employees
department_avg_salary
*/

WITH dept_stats AS (
    SELECT department_id,
           COUNT(*) AS total_employees,
           AVG(salary) AS department_avg_salary
    FROM hr.employees
    GROUP BY department_id
),
avg_emp_per_dept AS (
    SELECT AVG(total_employees) AS avg_emp_count
    FROM dept_stats
),
company_avg_salary AS (
    SELECT AVG(salary) AS company_avg_salary
    FROM hr.employees
)
SELECT d.department_id,
       d.total_employees,
       d.department_avg_salary
FROM dept_stats d
CROSS JOIN avg_emp_per_dept a
CROSS JOIN company_avg_salary c
WHERE d.total_employees > a.avg_emp_count
  AND d.department_avg_salary > c.company_avg_salary;



Q518. Using a CTE, find the number of employees in each department.

Answer:
with emp as
 (select department_id, count(*) as total_employees
    from hr.employees
   group by department_id)
select department_id, total_employees from emp;



Q519. Using a CTE, find the average salary per department.

Answer:
with emp as
 (select department_id, round(avg(salary),2) as avg_sal_dept
    from hr.employees
   group by department_id)
select department_id, avg_sal_dept from emp;



Q520. Using a CTE, list departments having more than 5 employees.

Answer:
with emp as
 (select department_id, count(*) as total_employees
    from hr.employees
   group by department_id)
select department_id, total_employees from emp where total_employees > 5;



Q521. Using a CTE, find employees whose salary is above the department average.

Answer:
with emp as
 (select employee_id, department_id, salary from hr.employees),
avg_sal as
 (select department_id, avg(salary) as avg_sal_dpt
    from hr.employees
   group by department_id
   )
select employee_id, d.department_id, salary
  from emp d
  join avg_sal a
    on d.department_id = a.department_id
 where salary > avg_sal_dpt
 order by d.department_id;

-- Using a CTE, calculate total salary paid per job_id.
with emp as
 (select job_id, sum(salary) as total_sal from hr.employees group by job_id)
select job_id, total_sal from emp;



Q522. employee count is greater than average employee count per department

Answer:
with emp as
 (select department_id, count(*) as employee_count
    from hr.employees
   group by department_id)
select department_id
  from emp
 where employee_count > (select avg(employee_count) from emp);



Q523. Using two CTEs, find departments where:

Answer:
with emp as
 (select department_id, avg(salary) as dpt_avg
    from hr.employees
   group by department_id),
emp_sal as
 (select avg(salary) as emp_avg from hr.employees)
select department_id
  from emp
 where dpt_avg > (select emp_avg from emp_sal);
-- 
 WITH dept_avg AS (
  SELECT department_id,
         AVG(salary) AS dept_avg_salary
  FROM hr.employees
  GROUP BY department_id
),
company_avg AS (
  SELECT AVG(salary) AS company_avg_salary
  FROM hr.employees
)
SELECT d.department_id
FROM dept_avg d
CROSS JOIN company_avg c
WHERE d.dept_avg_salary > c.company_avg_salary;



Q524. Using a CTE, find the top 2 highest

Answer:
WITH first_sal AS
 (SELECT department_id, MAX(salary) AS max_sal
    FROM hr.employees
   GROUP BY department_id),
second_sal AS
 (SELECT e.department_id, MAX(e.salary) AS second_sal
    FROM hr.employees e
    JOIN first_sal f
      ON e.department_id = f.department_id
   WHERE e.salary < f.max_sal
   GROUP BY e.department_id)
SELECT e.department_id, e.employee_id, e.salary
  FROM hr.employees e
  JOIN first_sal f
    ON e.department_id = f.department_id
   AND e.salary = f.max_sal

UNION ALL

SELECT e.department_id, e.employee_id, e.salary
  FROM hr.employees e
  JOIN second_sal s
    ON e.department_id = s.department_id AND e.salary = s.second_sal
 ORDER BY department_id, salary DESC;



Q525. Q.write a SQL query that counts the number of unique salespeople. Return number of salespeople.

Answer:
select count(distinct selsman_id)from orderr; --not done



Q526. Q. write a SQL query to determine the number of customers who received at least one grade for their activity.

Answer:
select count(cust_name) from customer
where grade >= 1;

select count(all grade) from customer;



Q527. Q.write a SQL query to find the minimum purchase amount.

Answer:
select min(purch_am) from orderr;


-- group by & having



Q528. Q, write a SQL query to count all the orders generated on '2012

Answer:
select count(ord_no) from orderr
group by ord_date
having ord_date = to_date('08-17-2012', 'MM-DD-YYYY');


select * from(
select e.*, row_number() over (partition by job_id order by salary desc) r
from hr.employees e )
where r <=2;

-- RANK()
-- Provides a rank to each row within a partition, with gaps in ranks for tied values.
SELECT employee_id, department_id, salary,
      RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) AS rank
FROM hr.employees;

SELECT employee_id, salary,
       rank() OVER (ORDER BY salary DESC) AS rank
FROM hr.employees;

-- DENSE_RANK()
-- Similar to RANK(), but without gaps. Tied values share the same rank, and the next rank is incremented sequentially.
SELECT employee_id, salary,
       DENSE_RANK() OVER (ORDER BY salary DESC) AS dense_rank
FROM hr.employees;

SELECT employee_id, department_id, salary,
       DENSE_RANK() OVER (PARTITION BY department_id ORDER BY salary DESC) AS dense_rank
FROM hr.employees;

-- LEAD()
-- Accesses data from the following row, allowing for "look
SELECT employee_id, salary,
       LEAD(salary, 1) OVER (ORDER BY salary) AS next_salary
FROM hr.employees;

-- LAG()
-- Accesses data from the preceding row, allowing for "look
SELECT employee_id, salary,
       LAG(salary, 2, 0) OVER (ORDER BY salary) AS previous_salary
FROM hr.employees;


